(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1686:function(e,t,i){"use strict";var n=i(11);i(2),i(31),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i(28);var a=n(i(2152));i(2162),i(2163);var r=i(928),o={install:function(e){e.component(a.default.name,a.default),e.use(r.ActionSheet),e.use(r.Icon)}};t.default=o},1977:function(e,t,i){"use strict";i.r(t);var n=i(1978),a=i.n(n);for(var r in n)"default"!==r&&function(e){i.d(t,e,(function(){return n[e]}))}(r);t.default=a.a},1978:function(e,t,i){"use strict";var n=i(11);i(2),i(104),i(49),i(71),i(140),i(78),i(394),i(30),i(21),i(401),i(161),i(60),i(74),i(157),i(239),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i(115),i(59),i(14),i(105);var a=n(i(106)),r=n(i(187)),o=n(i(158));i(72),i(73),i(50),i(79),i(36);var s=i(928),u=i(2153),c=i(2154),l=n(i(2160)).default.isMobile,d={name:"MediasMobile",model:{prop:"fileList",event:"change"},props:{mode:{type:String,default:"select"},value:{type:Array,default:function(){return[]}},enableVideo:{type:Boolean,default:!1},enableRecording:{type:Boolean,default:!1},fileList:{type:Array,default:function(){return[]}},max:{type:Number,default:-1},audioMax:{type:Number,default:-1},size:{type:Number},videoSize:{type:Number},correct:{type:Boolean,default:!1},compressWidth:{type:Number},compressHeight:{type:Number},base64:{type:Boolean,default:!1},column:{type:Number,default:3},marginRight:{type:Number,default:10},audioLoop:{type:Boolean,default:!1},downloadVideoAutoPlay:{type:Boolean,default:!0},audioRecordTime:{type:Number,default:60},videoRecordTime:{type:Number,default:15}},data:function(){return{supportCanvas:!0,previewItemShowWidth:0,show:!1,actions:[],showFullscreenVideoPreview:!1,fullscreenVideoPreviewSrc:"",playingAudioIndex:-1,showList:[],imgFullScreenPreviewList:[],showImgFullScreenPreviewList:!1,imgFullScreenPreviewCurrentIndex:0}},computed:{accept:function(){return this.enableVideo?"image/*,video/*":"image/*"},imgVideoPreviewList:function(){return this.filterFile(["img","video"])},audioPreviewList:function(){return this.filterFile(["audio"])},previewItemStyle:function(){return{width:this.previewItemShowWidth+"px",height:this.previewItemShowWidth+"px"}}},watch:{value:function(){this.handleShowData()}},mounted:function(){this.init(),this.initSize(),this.checkCanvasSupport(),this.bindEvent()},activated:function(){this.bindEvent()},deactivated:function(){this.unbindEvent()},beforeDestroy:function(){this.unbindEvent()},methods:{formatTime:c.formatTime,filterFile:function(e){return"show"===this.mode?this.showList.filter((function(t){return e.includes(t.type)})).map((function(e){return(0,o.default)((0,o.default)({},e),{},{url:"object"===(0,r.default)(e.file)?window.URL.createObjectURL(e.file):e.file})})):this.fileList.filter((function(t){return e.includes(t.type)})).map((function(e){return(0,o.default)((0,o.default)({},e),{},{url:"object"===(0,r.default)(e.file)?window.URL.createObjectURL(e.file):e.file})}))},init:function(){this.handleShowData(),this.initSelectActionList()},initSelectActionList:function(){var e=[{name:"拍摄照片",id:1},{name:"从手机相册选择",id:2},{name:"取消",id:4}];this.enableVideo&&e.splice(1,0,{name:"拍摄视频",id:3}),this.actions=e},initSize:function(){var e=this.$refs.mediaContainer.getBoundingClientRect().width;this.previewItemShowWidth=(e-this.marginRight*(this.column-1))/this.column},bindEvent:function(){window.addEventListener("resize",this.onResize)},unbindEvent:function(){window.removeEventListener("resize",this.onResize)},onResize:function(){this.initSize()},handleShowData:function(){if("show"!==this.mode)return!1;this.showList=this.value.map((function(e){return"audio"===e.type?(0,o.default)((0,o.default)({},e),{},{meta:{playing:!1,lastDuration:0,duration:0}}):(0,o.default)({},e)}))},onAddFileBtnClick:function(){if(!l)return!1;this.show=!0},selectFile:function(e){if(!l)return!1;var t={};switch(e){case 3:t={recordTime:this.videoRecordTime},this.selectVideoFileByNative(t);break;case 4:this.show=!1;break;case 1:case 2:t={destType:"0",srcType:e},this.selectImgByNative(t)}},selectVideoFileByNative:function(e){var t=this;hatom.native("VideoRecordPlugin.videoRecord",(function(e){t.show=!1;var i=JSON.parse(e.message);t.trigger({file:i.filePath,type:"video",native:!0,meta:{cover:"data:image/jpeg;base64,"+i.picBase64,duration:i.videoDuration},waitUpload:!0})}),e)},selectImgByNative:function(e){var t=this;hatom.camera((function(e){t.show=!1;var i="data:image/jpeg;base64,"+e.message;t.trigger({file:i,type:"img",waitUpload:!0})}),e)},checkCanvasSupport:function(){document.createElement("Canvas").getContext?this.supportCanvas=!0:this.supportCanvas=!1},fileChange:function(e){var t=this;return(0,a.default)(regeneratorRuntime.mark((function i(){var n,a,r,o,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!(-1!==t.max&&t.imgVideoPreviewList.length>=t.max)){i.next=3;break}return(0,s.Toast)("超过数量限制"),i.abrupt("return",!1);case 3:if(n=e.target.files[0]){i.next=6;break}return i.abrupt("return",!1);case 6:a=n.type,r="",o=n.size/1024/1024,u="",i.t0=!0,i.next=i.t0===(0,c.isImg)(a)?13:i.t0===(0,c.isVideo)(a)?16:19;break;case 13:return r="img",u=t.size,i.abrupt("break",20);case 16:return r="video",u=t.videoSize,i.abrupt("break",20);case 19:return i.abrupt("break",20);case 20:if(!(u&&o>u)){i.next=23;break}return(0,s.Toast)("超过".concat(u,"M的大小限制")),i.abrupt("return",!1);case 23:if(!(0,c.isImg)(a)||!t.supportCanvas){i.next=27;break}return i.next=26,t.imgHandle(n);case 26:n=i.sent;case 27:if(!t.base64){i.next=31;break}return i.next=30,(0,c.toDataURL)(n);case 30:n=i.sent;case 31:t.trigger({file:n,type:r,waitUpload:!0});case 32:case"end":return i.stop()}}),i)})))()},imgHandle:function(e){var t=this;return(0,a.default)(regeneratorRuntime.mark((function i(){var n,a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n=null,!t.correct){i.next=14;break}return i.prev=2,i.next=5,t.correctOrientation(e);case 5:n=i.sent,i.next=11;break;case 8:i.prev=8,i.t0=i.catch(2),n=e;case 11:e=n,i.next=27;break;case 14:if(!t.compressWidth&&!t.compressHeight){i.next=27;break}return i.prev=15,a={},t.compressWidth?a.w=t.compressWidth:a.h=t.compressHeight,i.next=20,(0,u.imgCompress)(e,a);case 20:n=i.sent,i.next=26;break;case 23:i.prev=23,i.t1=i.catch(15),n=e;case 26:e=n;case 27:return i.abrupt("return",e);case 28:case"end":return i.stop()}}),i,null,[[2,8],[15,23]])})))()},trigger:function(e){var t=this.fileList.concat([e]).map((function(e,t){return(0,o.default)((0,o.default)({},e),{},{index:t})}));this.$emit("change",t),this.$emit("input",t)},preview:function(e){"video"===e.type?this.previewVideo(e):this.previewImg(e)},previewVideo:function(e){e.native?this.playVideoByNative(e.file):e.download?this.downloadVideo(e):(this.fullscreenVideoPreviewSrc=e.url,this.showFullscreenVideoPreview=!0),this.$emit("videoPreview")},previewImg:function(e){var t=this.imgVideoPreviewList.filter((function(e){return"img"===e.type})).map((function(e){return e.url})),i=this.getIndex(e,"img");l?(0,s.ImagePreview)({images:t,startPosition:i}):(this.imgFullScreenPreviewList=t,this.imgFullScreenPreviewCurrentIndex=i,this.showImgFullScreenPreviewList=!0)},closeVideo:function(){this.showFullscreenVideoPreview=!1,this.fullscreenVideoPreviewSrc=""},uploadVideoByNative:function(e,t,i){return new Promise((function(n,a){try{var r={netRequestInfo:{url:t,isHttps:i},uploadFileInfoList:Array.isArray(e)?e.map((function(e){return{uploadFileUrl:e,uploadFileKey:"multipartFile"}})):[{uploadFileUrl:e,uploadFileKey:"multipartFile"}]};hatom.native("VideoRecordPlugin.upLoadFile",(function(e){console.log("上传成功",e),n(e)}),r)}catch(e){a(e)}}))},getIndex:function(e,t){for(var i=-1,n=0;n<this.imgVideoPreviewList.length&&(this.imgVideoPreviewList[n].type===t&&i++,this.imgVideoPreviewList[n]!==e);n++);return i},deleteFile:function(e){var t=this.fileList.filter((function(t){return e!==t.index}));this.$emit("change",t),this.$emit("input",t)},correctOrientation:function(e){var t=this;return new Promise((function(i,n){var a={};t.compressWidth&&(a={maxWidth:t.compressWidth,enableCompress:!0}),(0,u.handleFile)(e,a).then((function(e){i(e)})).catch((function(e){n(e)}))}))},onSelect:function(e){this.selectFile(e.id)},record:function(){var e=this,t={recordTime:this.audioRecordTime};hatom.native("VideoRecordPlugin.audioRecord",(function(t){e.show=!1;var i="data:audio/mp3;base64,"+t.message;e.trigger({file:i,type:"audio",meta:{playing:!1,lastDuration:0,duration:0}})}),t)},audioPlay:function(e){this.audioPreviewList[e].meta.playing?(this.audioPreviewList[e].meta.playing=!1,this.$refs["audio".concat(e)][0].load(),this.playingAudioIndex=-1):(-1!==this.playingAudioIndex&&(this.audioPreviewList[this.playingAudioIndex].meta.playing=!1,this.$refs["audio".concat(this.playingAudioIndex)][0].load()),this.playingAudioIndex=e,this.audioPreviewList[e].meta.playing=!0,this.$refs["audio".concat(e)][0].play())},audioTimeUpdate:function(e){try{this.audioPreviewList[e].meta.lastDuration=Math.max(this.audioPreviewList[e].meta.duration-parseInt(this.$refs["audio".concat(e)][0].currentTime),0)}catch(e){}},audioEnded:function(e){var t=this;this.audioLoop?(this.audioPreviewList[e].meta.playing=!1,setTimeout((function(){t.$refs["audio".concat(e)][0].play(),t.audioPreviewList[e].meta.playing=!0}),500)):(this.audioPreviewList[e].meta.playing=!1,this.$refs["audio".concat(e)][0].load(),this.playingAudioIndex=-1)},audioCanplay:function(e){var t=parseInt(this.$refs["audio".concat(e)][0].duration);this.audioPreviewList[e].meta.duration=t,this.audioPreviewList[e].meta.lastDuration=t},downloadVideo:function(e){var t=this;if(l){var i={url:e.file};hatom.native("VideoRecordPlugin.downLoadFile",(function(e){var i=JSON.parse(e.message);t.downloadVideoAutoPlay&&t.playVideoByNative(i.filePath)}),i)}else window.location.href=e.file,(0,s.Toast)("视频已开始下载")},playVideoByNative:function(e){hatom.native("VideoRecordPlugin.playVideo",(function(e){console.log("调用安卓功能预览成功")}),{videoFilePath:e})},getWaitUploadList:function(){return this.fileList.filter((function(e){return e.waitUpload}))},getWaitUploadVideoList:function(e,t){var i=this.getWaitUploadList().filter((function(t){var i="video"===t.type;return e?i&&t.native:i}));return t&&(i=i.map((function(e){return e.file}))),i},getWaitUploadImgList:function(e){return this.getTypeWaitUploadList("img",e)},getWaitUploadAudioList:function(e){return this.getTypeWaitUploadList("audio",e)},getTypeWaitUploadList:function(e,t){var i=this.getWaitUploadList().filter((function(t){return t.type===e}));return t&&(i=i.map((function(e){return e.file}))),i},handleShowBackData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)?e.map((function(e,t){var i=(0,o.default)((0,o.default)({},e),{},{index:t});switch(e.type){case"audio":i.meta={playing:!1,lastDuration:0,duration:0}}return i})):[]}}};t.default=d},1979:function(e,t,i){},2152:function(e,t,i){"use strict";i.r(t);var n=i(2252),a=i(1977);for(var r in a)"default"!==r&&function(e){i.d(t,e,(function(){return a[e]}))}(r);i(2161);var o=i(7),s=Object(o.a)(a.default,n.a,n.b,!1,null,"3ecc30ce",null);t.default=s.exports},2153:function(e,t,i){"use strict";var n=i(11);i(2),i(116),i(30),i(21),i(94),i(184),i(60),i(398),i(74),i(239),Object.defineProperty(t,"__esModule",{value:!0}),t.createKey=u,t.transformCoordinate=s,t.handleFile=function(e,t){return new Promise((function(i,n){var a=t.maxWidth,o=t.enableCompress,u=document.createElement("canvas"),c=u.getContext("2d"),l=new Image;try{l.src=URL.createObjectURL(e)}catch(e){throw Error(e)}l.onload=function(){var e=l.naturalWidth,t=l.naturalHeight;r.default.getData(l,(function(){var n=r.default.getTag(this,"Orientation"),d=o?Math.min(Number(a),e):e,f=t*(d/e);s(u,c,d,f,n),c.clearRect(0,0,d,f),c.drawImage(l,0,0,d,f),URL.revokeObjectURL(l.src);var h=u.toDataURL("image/jpeg");i(h)}))},l.onerror=function(e){return n(e)}}))},t.encryptUrl=function(e,t,i){var n=u(16),a=u(16),r=function(e,t,i){return t=o.default.enc.Utf8.parse(t),i=o.default.enc.Utf8.parse(i),o.default.AES.encrypt(e,t,{iv:i,mode:o.default.mode.CBC,padding:o.default.pad.Pkcs7}).ciphertext.toString()}(e.split(",")[1],n,a),s=i.encrypt(t,n),c=i.encrypt(t,a);return{file:r,keyRSA:s,ivRSA:c}},t.imgCompress=function(e,t){return new Promise((function(i,n){var r=t.w,o=t.h;if(!(r&&"number"==typeof r||o&&"number"==typeof o))throw Error("缺少必要参数");var s=document.createElement("canvas"),u=s.getContext("2d"),c=new Image;if("object"===(0,a.default)(e))try{c.src=URL.createObjectURL(e)}catch(e){throw Error(e)}else{if("string"!=typeof e)throw Error("类型不合法");c.src=e}c.onload=function(){var e,t,n=c.naturalWidth,a=c.naturalHeight;r?t=a*((e=r)/n):e=n*((t=o)/a),s.width=e,s.height=t,u.clearRect(0,0,e,t),u.drawImage(c,0,0,e,t),URL.revokeObjectURL(c.src);var l=s.toDataURL("image/jpeg");i(l)},c.onerror=function(e){return n(e)}}))},i(64),i(65),i(80);var a=n(i(187));i(36),i(59),i(14);var r=n(i(934)),o=n(i(935));function s(e,t,i,n,a){switch(a){case 5:case 6:case 7:case 8:e.width=n,e.height=i;break;default:e.width=i,e.height=n}switch(a){case 2:t.translate(i,0),t.scale(-1,1);break;case 3:t.translate(i,n),t.rotate(Math.PI);break;case 4:t.translate(0,n),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-n);break;case 7:t.rotate(.5*Math.PI),t.translate(i,-n),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-i,0)}}function u(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"],i="",n=0;n<e;n++){var a=Math.floor(36*Math.random());i+=t[a]}return i}},2154:function(e,t,i){"use strict";var n=i(11);i(2),i(21),i(94),i(2155),Object.defineProperty(t,"__esModule",{value:!0}),t.formatTime=t.captureImage=t.toDataURL=t.isAudio=t.isImg=t.isVideo=t.checkType=void 0,i(2158),i(59),i(14);var a=n(i(187));t.checkType=function(e){var t="",i=/^data:(.+);base64,.+/.exec(e);"object"===(0,a.default)(e)?t=e.type:i&&(t=i[1]);for(var n=[[o,"img"],[r,"video"],[s,"audio"]],u=0;u<n.length;u++)if(n[u][0](t))return n[u][1];return"img"};var r=function(e){return/^video\//.test(e)};t.isVideo=r;var o=function(e){return/^image\//.test(e)};t.isImg=o;var s=function(e){return/^audio\//.test(e)};t.isAudio=s;t.toDataURL=function(e){return new Promise((function(t){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsDataURL(e)}))};t.captureImage=function(e){var t=document.createElement("canvas");return t.width=.6*e.videoWidth,t.height=.6*e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL("image/png")};t.formatTime=function(e){return String(Math.floor(e/60)).padStart(2,0)+":"+String(e%60).padStart(2,0)}},2155:function(e,t,i){"use strict";var n=i(9),a=i(2156).start;n({target:"String",proto:!0,forced:i(2157)},{padStart:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},2156:function(e,t,i){var n=i(63),a=i(932),r=i(81),o=Math.ceil,s=function(e){return function(t,i,s){var u,c,l=String(r(t)),d=l.length,f=void 0===s?" ":String(s),h=n(i);return h<=d||""==f?l:(u=h-d,(c=a.call(f,o(u/f.length))).length>u&&(c=c.slice(0,u)),e?l+c:c+l)}};e.exports={start:s(!1),end:s(!0)}},2157:function(e,t,i){var n=i(403);e.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(n)},2158:function(e,t,i){"use strict";var n=i(16),a=i(2159),r=i(929),o=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(r);n(n.P+n.F*o,"String",{padStart:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},2159:function(e,t,i){var n=i(90),a=i(933),r=i(141);e.exports=function(e,t,i,o){var s=String(r(e)),u=s.length,c=void 0===i?" ":String(i),l=n(t);if(l<=u||""==c)return s;var d=l-u,f=a.call(c,Math.ceil(d/c.length));return f.length>d&&(f=f.slice(0,d)),o?f+s:s+f}},2160:function(e,t,i){"use strict";i(2),i(396),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i(103);var n,a={isMobile:(n=window.navigator.platform).indexOf("Linux arm")>-1||n.indexOf("iphone")>-1||n.indexOf("Linux")>-1||n.indexOf("iPhone")>-1,sHeight:screen.height,sWidth:screen.width};t.default=a},2161:function(e,t,i){"use strict";var n=i(1979);i.n(n).a},2162:function(e,t,i){},2163:function(e,t,i){},2252:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"mediaContainer",staticClass:"mediaContainer"},[i("div",{staticClass:"imgVideoContainer"},[e._l(e.imgVideoPreviewList,(function(t,n){return i("div",{key:n,staticClass:"uploadPreviewItem previewItem",class:["_"+e.column],style:{marginRight:e.marginRight+"px"}},["img"===t.type?i("img",{staticClass:"prevImg",style:e.previewItemStyle,attrs:{src:t.url},on:{click:function(i){return e.preview(t)}}}):e._e(),"video"!==t.type||!t.waitUpload||t.native||t.download?e._e():i("video",{ref:"video"+n,refInFor:!0,staticClass:"prevVideo",style:e.previewItemStyle,attrs:{src:t.url},on:{click:function(i){return e.preview(t)}}}),"video"===t.type&&t.meta&&t.meta.cover?i("div",{staticClass:"videoInfo",style:e.previewItemStyle,on:{click:function(i){return e.preview(t)}}},[i("img",{staticClass:"cover",attrs:{src:t.meta.cover,alt:""}}),i("div",{staticClass:"videoMask"}),i("span",{staticClass:"duration"},[e._v(e._s(e.formatTime(t.meta.duration)))])]):e._e(),"select"===e.mode?i("i",{staticClass:"van-icon van-icon-clear deleteImgIcon",on:{click:function(i){return e.deleteFile(t.index)}}}):e._e()])})),"select"===e.mode&&(-1===e.max||e.imgVideoPreviewList.length<e.max)?i("div",{ref:"uploadBtn",staticClass:"uploadBtn previewItem",class:["_"+e.column],style:Object.assign({},e.previewItemStyle,{marginRight:e.marginRight+"px"}),on:{click:e.onAddFileBtnClick}},[i("i",{staticClass:"van-icon van-icon-plus uploadeIcon"}),i("input",{attrs:{type:"file",accept:e.accept},on:{change:e.fileChange}})]):e._e()],2),i("div",{staticClass:"audioContainer"},[i("ul",{staticClass:"audioList"},e._l(e.audioPreviewList,(function(t,n){return i("li",{key:n,staticClass:"audioItem"},[i("div",{staticClass:"audioItemLeft"},[i("span",{staticClass:"audioIcon",class:{pause:t.meta.playing},on:{click:function(t){return e.audioPlay(n)}}})]),i("div",{staticClass:"audioItemRight"},[i("span",{staticClass:"audioDuration"},[e._v("\n            "+e._s(t.meta.lastDuration)+"\n            "),i("i",[e._v("〃")])])]),i("audio",{ref:"audio"+n,refInFor:!0,attrs:{src:t.url},on:{canplay:function(t){return e.audioCanplay(n)},timeupdate:function(t){return e.audioTimeUpdate(n)},ended:function(t){return e.audioEnded(n)}}}),"select"===e.mode?i("i",{staticClass:"van-icon van-icon-clear deleteImgIcon",on:{click:function(i){return e.deleteFile(t.index)}}}):e._e()])})),0),"select"===e.mode&&e.enableRecording&&(-1===e.audioMax||e.audioPreviewList.length<e.audioMax)?i("div",{staticClass:"recordBtn",on:{click:e.record}},[i("span",{staticClass:"recordBtnIcon"}),i("span",{staticClass:"recordBtnText"},[e._v("录音")])]):e._e()]),i("van-action-sheet",{attrs:{actions:e.actions},on:{select:e.onSelect},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}}),e.showFullscreenVideoPreview?i("div",{staticClass:"fullscreenVideoPreview"},[i("van-icon",{staticClass:"closeBtn",attrs:{name:"cross"},on:{click:e.closeVideo}}),i("video",{attrs:{src:e.fullscreenVideoPreviewSrc,controls:"controls"}})],1):e._e(),i("h-img-preview",{attrs:{data:e.imgFullScreenPreviewList,visible:e.showImgFullScreenPreviewList,"current-index":e.imgFullScreenPreviewCurrentIndex,"show-album":!1},on:{"update:visible":function(t){e.showImgFullScreenPreviewList=t}}})],1)},a=[]}}]);