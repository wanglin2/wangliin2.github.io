<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>手摸手带你实现一个时间轴组件 | 王林的个人博客</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="如题。">
    <link rel="preload" href="/vue_components/assets/css/0.styles.44e76d06.css" as="style"><link rel="preload" href="/vue_components/assets/js/app.2a8a8f25.js" as="script"><link rel="preload" href="/vue_components/assets/js/3.2c2d63e0.js" as="script"><link rel="preload" href="/vue_components/assets/js/12.beda9d7e.js" as="script"><link rel="prefetch" href="/vue_components/assets/js/10.98a59543.js"><link rel="prefetch" href="/vue_components/assets/js/11.a3f72a87.js"><link rel="prefetch" href="/vue_components/assets/js/13.b2d14e44.js"><link rel="prefetch" href="/vue_components/assets/js/14.c3d40cd0.js"><link rel="prefetch" href="/vue_components/assets/js/15.147456b6.js"><link rel="prefetch" href="/vue_components/assets/js/16.09e712e0.js"><link rel="prefetch" href="/vue_components/assets/js/17.c273d05b.js"><link rel="prefetch" href="/vue_components/assets/js/18.dfc13ad2.js"><link rel="prefetch" href="/vue_components/assets/js/19.e493a27d.js"><link rel="prefetch" href="/vue_components/assets/js/2.269dabf8.js"><link rel="prefetch" href="/vue_components/assets/js/20.01c1b058.js"><link rel="prefetch" href="/vue_components/assets/js/21.af94e53b.js"><link rel="prefetch" href="/vue_components/assets/js/22.3bf75fad.js"><link rel="prefetch" href="/vue_components/assets/js/23.a2bcb9ac.js"><link rel="prefetch" href="/vue_components/assets/js/24.0df4e39e.js"><link rel="prefetch" href="/vue_components/assets/js/25.69c54982.js"><link rel="prefetch" href="/vue_components/assets/js/26.9b4ba29f.js"><link rel="prefetch" href="/vue_components/assets/js/27.ee644eda.js"><link rel="prefetch" href="/vue_components/assets/js/28.caa4a1dc.js"><link rel="prefetch" href="/vue_components/assets/js/29.52c76767.js"><link rel="prefetch" href="/vue_components/assets/js/30.de768e43.js"><link rel="prefetch" href="/vue_components/assets/js/31.7915573b.js"><link rel="prefetch" href="/vue_components/assets/js/32.9c27ade0.js"><link rel="prefetch" href="/vue_components/assets/js/33.2476d2ad.js"><link rel="prefetch" href="/vue_components/assets/js/34.2335453a.js"><link rel="prefetch" href="/vue_components/assets/js/35.9ad374ff.js"><link rel="prefetch" href="/vue_components/assets/js/36.4ee74c83.js"><link rel="prefetch" href="/vue_components/assets/js/37.b32ab3f2.js"><link rel="prefetch" href="/vue_components/assets/js/38.661cdba2.js"><link rel="prefetch" href="/vue_components/assets/js/39.71b3f624.js"><link rel="prefetch" href="/vue_components/assets/js/4.f800e40a.js"><link rel="prefetch" href="/vue_components/assets/js/40.c6ccc062.js"><link rel="prefetch" href="/vue_components/assets/js/41.f15ab095.js"><link rel="prefetch" href="/vue_components/assets/js/42.1c034c68.js"><link rel="prefetch" href="/vue_components/assets/js/43.a02b503a.js"><link rel="prefetch" href="/vue_components/assets/js/44.eefc404f.js"><link rel="prefetch" href="/vue_components/assets/js/45.be81dec7.js"><link rel="prefetch" href="/vue_components/assets/js/46.40d79946.js"><link rel="prefetch" href="/vue_components/assets/js/47.94a4753a.js"><link rel="prefetch" href="/vue_components/assets/js/48.b42985d7.js"><link rel="prefetch" href="/vue_components/assets/js/49.2c2ade50.js"><link rel="prefetch" href="/vue_components/assets/js/5.cd6a39c1.js"><link rel="prefetch" href="/vue_components/assets/js/50.12afd37f.js"><link rel="prefetch" href="/vue_components/assets/js/51.c62b92d1.js"><link rel="prefetch" href="/vue_components/assets/js/52.40ef81eb.js"><link rel="prefetch" href="/vue_components/assets/js/53.aef88493.js"><link rel="prefetch" href="/vue_components/assets/js/54.b41dbe03.js"><link rel="prefetch" href="/vue_components/assets/js/55.d4fdf48f.js"><link rel="prefetch" href="/vue_components/assets/js/56.3968eef5.js"><link rel="prefetch" href="/vue_components/assets/js/57.883fcc59.js"><link rel="prefetch" href="/vue_components/assets/js/6.b5ffe322.js"><link rel="prefetch" href="/vue_components/assets/js/7.d38dc03c.js"><link rel="prefetch" href="/vue_components/assets/js/8.c70e3692.js"><link rel="prefetch" href="/vue_components/assets/js/9.b8fbaa3e.js">
    <link rel="stylesheet" href="/vue_components/assets/css/0.styles.44e76d06.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/vue_components/" class="home-link router-link-active"><!----><span class="site-name">王林的个人博客</span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><!----><ul class="sidebar-links"><li><a href="/vue_components/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/vue_components/zh/about/" class="sidebar-link">关于</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>分享</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/share/12.html" class="sidebar-link">【汉诺塔】小游戏开发教程</a></li><li><a href="/vue_components/zh/share/11.html" class="sidebar-link">OpenLayers入门（二）</a></li><li><a href="/vue_components/zh/share/1.html" class="sidebar-link">如何实现一个排序算法演示动画</a></li><li><a href="/vue_components/zh/share/2.html" class="sidebar-link">如何实现一个vue组件库的在线主题编辑器</a></li><li><a href="/vue_components/zh/share/3.html" class="sidebar-link">OpenLayers入门（一）</a></li><li><a href="/vue_components/zh/share/4.html" aria-current="page" class="active sidebar-link">手摸手带你实现一个时间轴组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue_components/zh/share/4.html#这是开头" class="sidebar-link">这是开头</a></li><li class="sidebar-sub-header"><a href="/vue_components/zh/share/4.html#开发时间" class="sidebar-link">开发时间</a></li></ul></li><li><a href="/vue_components/zh/share/5.html" class="sidebar-link">lerna入门</a></li><li><a href="/vue_components/zh/share/6.html" class="sidebar-link">Preset预设</a></li><li><a href="/vue_components/zh/share/7.html" class="sidebar-link">2的0次方为什么等于1？</a></li><li><a href="/vue_components/zh/share/8.html" class="sidebar-link">汉诺塔游戏与递归</a></li><li><a href="/vue_components/zh/share/9.html" class="sidebar-link">又一篇介绍vue3.0组合式api的文章</a></li><li><a href="/vue_components/zh/share/10.html" class="sidebar-link">浅析浏览器书签的导入和导出</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发指南</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/guide/start.html" class="sidebar-link">简介</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>PC端组件</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/web/sCharts/" class="sidebar-link">sCharts 图表组件</a></li><li><a href="/vue_components/zh/web/inRange/" class="sidebar-link">InRange 分数展示组件</a></li><li><a href="/vue_components/zh/web/asyncTreeInput/" class="sidebar-link">AsyncTreeInput 异步树输入框组件</a></li><li><a href="/vue_components/zh/web/markerImg/" class="sidebar-link">MarkerImg 带标注的图片显示组件</a></li><li><a href="/vue_components/zh/web/markImgView/" class="sidebar-link">MarkImgView 图片预览组件</a></li><li><a href="/vue_components/zh/web/mediaViewList/" class="sidebar-link">MediaViewList 媒体预览组件</a></li><li><a href="/vue_components/zh/web/processStepList/" class="sidebar-link">ProcessStepList 步骤列表组件</a></li><li><a href="/vue_components/zh/web/simpleDetail/" class="sidebar-link">SimpleDetail 简易详情组件</a></li><li><a href="/vue_components/zh/web/virtualList/" class="sidebar-link">VirtualList 虚拟列表组件</a></li><li><a href="/vue_components/zh/web/importDialog/" class="sidebar-link">ImportDialog 文件导入弹窗组件</a></li><li><a href="/vue_components/zh/web/imgUpload/" class="sidebar-link">ImgUpload 图片选择上传组件</a></li><li><a href="/vue_components/zh/web/tagCard/" class="sidebar-link">TagCard 标签选择卡片组件</a></li><li><a href="/vue_components/zh/web/mInfoList/" class="sidebar-link">MInfoList 简易信息翻页展示组件</a></li><li><a href="/vue_components/zh/web/marquee/" class="sidebar-link">Marquee 跑马灯组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>PC端mixin</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/webMixin/thDropdownMixin/" class="sidebar-link">thDropdownMixin 表头下拉菜单混入</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>APP端组件</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/app/markerImgMobile/" class="sidebar-link">MarkerImgMobile 带标注的图片预览组件</a></li><li><a href="/vue_components/zh/app/mediasMobile/" class="sidebar-link">MediasMobile 媒体组件选择预览组件</a></li><li><a href="/vue_components/zh/app/switchBtn/" class="sidebar-link">SwitchBtn 按钮组</a></li><li><a href="/vue_components/zh/app/quickInput/" class="sidebar-link">QuickInput 快速输入框</a></li><li><a href="/vue_components/zh/app/iTouch/" class="sidebar-link">ITouch 触摸拖动库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>APP端mixin</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/appMixin/stRecovery/" class="sidebar-link">stRecovery 滚动位置恢复</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>库</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/library/observer/" class="sidebar-link">Observer 发布订阅库</a></li><li><a href="/vue_components/zh/library/measure/" class="sidebar-link">OpenLayers 测距离面积</a></li><li><a href="/vue_components/zh/library/markjs/" class="sidebar-link">markjs 标注库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>代码片段</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/fragment/openlayers/" class="sidebar-link">OpenLayers 相关</a></li><li><a href="/vue_components/zh/fragment/data/" class="sidebar-link">数据相关</a></li><li><a href="/vue_components/zh/fragment/date/" class="sidebar-link">时间日期相关</a></li><li><a href="/vue_components/zh/fragment/utils/" class="sidebar-link">工具函数</a></li><li><a href="/vue_components/zh/fragment/latLon/" class="sidebar-link">坐标系转换</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>具体业务组件</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/business/cm/multiStreet/" class="sidebar-link">【CM】MultiStreet 多街道</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/others/sites/" class="sidebar-link">网址导航</a></li></ul></section></li></ul></aside><main class="page"><div class="theme-default-content content__default"><h1 id="手摸手带你实现一个时间轴组件"><a href="#手摸手带你实现一个时间轴组件" class="header-anchor">#</a> 手摸手带你实现一个时间轴组件</h1><h2 id="这是开头"><a href="#这是开头" class="header-anchor">#</a> 这是开头</h2><p>我司涉及到视频和地图的业务很多，所以常常需要开发一些有特色的组件，本期给大家带来一个时间轴的组件开发教程，话不多说，先看动图：</p><p><img src="/vue_components/assets/img/4-1.d19c0dfe.gif" alt="1"></p><p>主要功能就是可以拖动时间轴来定位当前时间，可以通过鼠标滚轮来修改当前时间分辨率，也支持显示时间段功能，动图未体现，可看下面的本次demo效果示例：</p><p><img src="/vue_components/assets/img/4-2.94625d51.gif" alt="4"></p><p>如果对canvas不太熟悉的话可以先看一下教程：<a href="https://www.runoob.com/tags/ref-canvas.html" target="_blank" rel="noopener noreferrer">https://www.runoob.com/tags/ref-canvas.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>接下来进入开发时间。</p><h2 id="开发时间"><a href="#开发时间" class="header-anchor">#</a> 开发时间</h2><p>前端框架依旧使用的是vue，这个组件交互是通过canvas实现的，模板非常简单：</p><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>timeLineContainer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>timeLineContainer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span>
      <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@mousemove</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onMousemove<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@mouseout</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onMouseout<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@mousedown</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onMousedown<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@mousewheel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onMouseweel<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>绑定了四个事件，后续再细说。</p><h3 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h3><p>首先要做的是设置一下画布的宽高及获取画图上下文：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">init</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取外层宽高</span>
            <span class="token keyword">let</span> <span class="token punctuation">{</span>
                width<span class="token punctuation">,</span>
                height
            <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>timeLineContainer<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> width
            <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height
            <span class="token comment">// 设置画布宽高为外层元素宽高</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> width
            <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> height
            <span class="token comment">// 获取画图上下文</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="中间的白色竖线"><a href="#中间的白色竖线" class="header-anchor">#</a> 中间的白色竖线</h3><p>中间的白色竖线代表的就是当前的时间，但是就线而言它只是一条线，所以先把它画了：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 这个函数是整个绘制方法，所有的绘制方法都在此调用</span>
    <span class="token function">draw</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawMiddleLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 画中间的白色竖线</span>
    <span class="token function">drawMiddleLine</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> lineWidth <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token comment">// 线的x坐标是时间轴的中点，y坐标即时间轴的高度</span>
        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span> lineWidth<span class="token punctuation">,</span> <span class="token string">'#fff'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 画线段方法</span>
    <span class="token function">drawLine</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> lineWidth <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">'#fff'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 开始一段新路径</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 设置线段颜色</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">'#fff'</span>
        <span class="token comment">// 设置线段宽度</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> lineWidth
        <span class="token comment">// 将路径起点移到x1,y1</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span>
        <span class="token comment">// 将路径移动到x2,y2</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span>
        <span class="token comment">// 把路径画出来</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样白色竖线就有了：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABpQAAAA/CAYAAADuUiu6AAACY0lEQVR4nO3bIQ7EMAwAweRU3v//sj/IoZNOBVuYghloZGqtPK/rWuPPeZ4DAAAAAAAAfj67FwAAAAAAAODdBCUAAAAAAACSoAQAAAAAAEASlAAAAAAAAEiCEgAAAAAAAElQAgAAAAAAIAlKAAAAAAAApOM+mHPu2AMAAOBV1lpjDDcSAADAGD6UAAAAAAAAeCAoAQAAAAAAkAQlAAAAAAAAkqAEAAAAAABAEpQAAAAAAABIghIAAAAAAABJUAIAAAAAACAJSgAAAAAAACRBCQAAAAAAgCQoAQAAAAAAkAQlAAAAAAAAkqAEAAAAAABAEpQAAAAAAABIghIAAAAAAABJUAIAAAAAACAJSgAAAAAAACRBCQAAAAAAgCQoAQAAAAAAkAQlAAAAAAAAkqAEAAAAAABAEpQAAAAAAABIghIAAAAAAABJUAIAAAAAACAJSgAAAAAAACRBCQAAAAAAgCQoAQAAAAAAkAQlAAAAAAAAkqAEAAAAAABAEpQAAAAAAABIghIAAAAAAABJUAIAAAAAACAJSgAAAAAAACRBCQAAAAAAgCQoAQAAAAAAkAQlAAAAAAAAkqAEAAAAAABAEpQAAAAAAABIghIAAAAAAABJUAIAAAAAACAJSgAAAAAAACRBCQAAAAAAgCQoAQAAAAAAkAQlAAAAAAAAkqAEAAAAAABAEpQAAAAAAABIghIAAAAAAABJUAIAAAAAACAd98Faa8ceAAAAr+RGAgAA8KEEAAAAAADAA0EJAAAAAACAJCgBAAAAAACQBCUAAAAAAACSoAQAAAAAAEASlAAAAAAAAEhfw28NezUhzdkAAAAASUVORK5CYII=" alt="image-20200414190926112"></p><h3 id="时间刻度"><a href="#时间刻度" class="header-anchor">#</a> 时间刻度</h3><p>时间刻度是本组件的核心，支持调整时间分辨率（就是整个时间轴所表示的时间范围，也即每两刻度之间的一格代表的时间大小），暂定包含<code>0.5, 1, 2, 6, 12, 24</code>这五种，单位是小时，先定义几个变量：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一小时的毫秒数</span>
<span class="token keyword">const</span> <span class="token constant">ONE_HOUR_STAMP</span> <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span>
<span class="token comment">// 时间分辨率</span>
<span class="token keyword">const</span> <span class="token constant">ZOOM</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token comment">// 当前所在时间分辨率的类型索引</span>
            currentZoomIndex<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
            <span class="token comment">// 当前时间</span>
            currentTime<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token comment">// 时间轴左侧起点所代表的时间，默认为当天的0点减12小时，即昨天中午12点</span>
            startTimestamp<span class="token operator">:</span>
            <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span>
            <span class="token number">12</span> <span class="token operator">*</span> <span class="token constant">ONE_HOUR_STAMP</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>时间分辨率放在<code>ZOOM</code>的数组里，先以24分辨率来开发，24代表的是整个时间轴表示的时间范围为24小时。但是具体用一格表示多久呢，可以1个小时1格，也可以半个小时一格，随便你，这里就用一格表示半个小时，其他分辨率也是如此，为了方便也把它们装到一个数组里：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 时间分辨率对应的每格小时数</span>
<span class="token keyword">const</span> <span class="token constant">ZOOM_HOUR_GRID</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span>
</code></pre></div><p>0.5就代表1小格代表0.5个小时，既然每格代表的小时数知道了，那么时间轴一共需要画多少格也就确定了：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一共可以绘制的格数，时间轴的时间范围小时数除以每格代表的小时数，24/0.5=48</span>
<span class="token keyword">let</span> gridNum <span class="token operator">=</span> <span class="token constant">ZOOM</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token constant">ZOOM_HOUR_GRID</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex<span class="token punctuation">]</span>
</code></pre></div><p>因为时间计算都是通过毫秒进行计算，所以先算一下一格代表多少毫秒：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一格多少毫秒，将每格代表的小时数转成毫秒数就可以了</span>
<span class="token keyword">let</span> msPerGrid <span class="token operator">=</span> <span class="token constant">ZOOM_HOUR_GRID</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token constant">ONE_HOUR_STAMP</span>
</code></pre></div><p>接下来是关键，因为要画图，最终还是要知道像素大小，那么每格是多少像素呢：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 每格宽度，时间轴的宽度除以总格数</span>
<span class="token keyword">let</span> pxPerGrid <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">/</span> gridNum
</code></pre></div><p>接下来事情似乎就简单了，循环一下画出刻度就好了：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> gridNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 横坐标就是当前索引乘每格宽度</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> i <span class="token operator">*</span> pxPerGrid
    <span class="token comment">// 当前刻度的时间，时间轴起始时间加上当前格子数乘每格代表的毫秒数</span>
    <span class="token keyword">let</span> graduationTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp <span class="token operator">+</span> i <span class="token operator">*</span> msPerGrid
    <span class="token comment">// 刻度高度为时间轴高度的20%</span>
    <span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.2</span>
    <span class="token comment">// 刻度线颜色</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(151,158,167,1)'</span>
    <span class="token comment">// 显示时间</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">graduationTitle</span><span class="token punctuation">(</span>graduationTime<span class="token punctuation">)</span><span class="token punctuation">,</span>
        x <span class="token operator">-</span> <span class="token number">13</span><span class="token punctuation">,</span><span class="token comment">// 向左平移一半</span>
        h <span class="token operator">+</span> <span class="token number">15</span><span class="token comment">// 加上行高</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> h<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'rgba(151,158,167,1)'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>graduationTitle</code>方法是用来格式时间的，在0点时显示日期而不是时间：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">graduationTitle</span> <span class="token punctuation">(</span><span class="token parameter">datetime</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> time <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span>
    <span class="token comment">// 0点则显示当天日期</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
        time<span class="token punctuation">.</span><span class="token function">hours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
        time<span class="token punctuation">.</span><span class="token function">minutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
        time<span class="token punctuation">.</span><span class="token function">milliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> time<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'MM-DD'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 否则显示小时和分钟</span>
        <span class="token keyword">return</span> time<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'HH:mm'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>看下效果：</p><p><img src="data:image/png;base64,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" alt="image-20200415091820701"></p><p>似乎很完美，但是这样的真的可以了吗？不妨把起始时间加上个15分钟看一下：</p><div class="language- extra-class"><pre class="language-text"><code>startTimestamp:
        new Date(moment().format('YYYY-MM-DD 00:00:00')).getTime() -
        12 * ONE_HOUR_STAMP +
        15 * 60 * 1000// 加15分钟
</code></pre></div><p>起始时间加上15分钟，则为12:15分，看下效果：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABpkAAABCCAYAAACsEL4VAAAWjElEQVR4nO3de3CdZZ3A8e9JC01paUrbJIXS0kVEejFbKMzgolhALBcHtSNqHWTd7ijLSF226yiICrq6uAzDVCtbLjOV2XW2uqsVmcUVFVFqBae2YqEXywClUCANl7Q2NLGXs3+8OadN8pzkXJ/3pP1+ZsIJaU767e9c8r558r4n09nZmaWAY1at4rhFi9j34Q/z5j330NTUVOhTD8lmYdMmePjh5G31anjjjYGfN2UKnH128jZ3bvLW0jL015ckSZIkSZIkSVLqRg72hw1btwJwcOLE4r9iJgOzZiVvn/lMsuj0zDOwdu2htz/8AXbsSN5+/OND15069dCiU+5y0qSy/mGSJEmSJEmSJEmqnUEXmUZs3gxAdtq08v+GTAZOOy15W7gw+diBA/D007B+Paxbl1yuXw8vvJC8/ehHh64/fTqcfz7Mm5e8TZ+efE1JkiRJkiRJkiSlJlPwdHn79nH8nDk07NhB109/yv5zzy3udHnlOngQnn2278LTunUDT7U3bVqy2PTe98L73ge1bJIkSZIkSZIkSVJQwUWmUXfdReMNN3DwjDP482OPQSZT20WmkGwWtmyB3/wmeW2n1ath27ZDf37sscli04c+BFdcASecELdPkiRJkiRJkiTpKBVcZMq88QbHn3kmmc5Our73PfZfcglA/EWmkBdfhF/8Inktp4cegr17k4+PHJksNH3hC8lrOUmSJEmSJEmSJKlmgotMo2+4gWPvuov98+bR9aMf5V8DqS4WmQ735pvws5/B/ffDD38Ie/YkH58/H266Cd71rnT7JEmSJEmSJEmSjlADFpkann6a49/xDjh4kD2rV3Ng1qz8n9XdItPhOjvhnnvgm9+El15KPvb+98OKFTBhQrptkiRJkiRJkiRJR5iG/h9o/NKXYP9+/vLxj/dZYKp748fD5z4Hzz0H990HLS3JKfXmzk1OsSdJkiRJkiRJkqSq6XMkU8Nzz3H8mWfCqFHsfvJJsi0tfT65ro9k6q+9HT74QXjsMWhrg7Vr4dhj066SJEmSJEmSJEk6IvQ5kunY738fgH2XXTZggWnYaW2FBx+E006DDRuS0+hJkiRJkiRJkiSpKg4tMmWzHPO97wGw7yMfSaunuk44Ae68M3n/q1899FpNkiRJkiRJkiRJqkj+dHkjHn+csZdcQnbCBHZv2RI8tdzSpUu55ZZbokf2l2sotuWHwALgW8A/ptxSS7aE2RJmS5gtYbaE2RJmS5gtYbaE2RJWTy3ZbHLW8Uwmk3JJfc3FljBbwmwJsyXMljBbwmwJsyXMljBbwmwZKH8kU/5UeQsWHHGvXfSl3stFwDB6VSlJkiRJkiRJkqS6lV9kGrlmDQD7Lr00tZha2QT8FBgL/H3KLZIkSZIkSZIkSUeCZJGpu5uGZ54B4MDs2Wn21MzS3su/TbVCkiRJkiRJkiTpyNAAMGLrVjhwgOzEiWRbWtJuqomHgV1AG3BSyi2SJEmSJEmSJEnDXbLItHEjAAdmzIBBXrg29+K2actmsyW37Ad+0fv+JSm31IotYbaE2RJmS5gtYbaE2RJmS5gtYbaE1VNLPamnudgSZkuYLWG2hNkSZkuYLWG2hNkSZkuYLQM1ADRs2QLAwRkzBv3kzCALUDFlMpmyWn7ae3lBHbTUgi1htoTZEmZLmC1htoTZEmZLmC1htoTVU0s9qae52BJmS5gtYbaE2RJmS5gtYbaE2RJmS5gtA40EyOzZA0B2/PhBP7keVsWg/I6tvZdTq5dSNzMBWwqxJcyWMFvCbAmzJcyWMFvCbAmzJayeWupJPc3FljBbwmwJsyXMljBbwmwJsyXMljBbwmwZaCQAf/kLANljjhn0k+thVQzK73il9/LE6qXUzUzAlkJsCbMlzJYwW8JsCbMlzJYwW8JsCaunlnpST3OxJcyWMFvCbAmzJcyWMFvCbAmzJcyWMFsGSo5k2rcv+b9Rowb95HpZGSu34+Xey5Oql1I3MwFbCrElzJYwW8JsCbMlzJYwW8JsCbMlrJ5a6kk9zcWWMFvCbAmzJcyWMFvCbAmzJcyWMFvCbBko09nZmT1u0SKOWbWK7ltvpefaawt+8vghTqdX70YC+4AD5A7hkiRJkqTS5Xbo6uW3ByVJkiQpDQ3Jf5ML9u9PMaX2Gnsvu1OtkCRJkiRJkiRJGv4aAA42NwOQ6ehINabWcicDdJFJkiRJkiRJkiSpMg0A2dbW5H927kw1ptZyi0w9qVZIkiRJkiRJkiQNf30WmTJHySKTRzJJkiRJkiRJkiRVJjldXksLAJn29lRjam1C7+WuVCskSZIkSZIkSZKGv6PqdHnTei+3p1ohSZIkSZIkSZI0/I2Ew45keu01OHAARowY8oozZrXxd5/8NN+59042b9zAmDFjuf5zX+TkqacA8OILz7P0tq/R1bWn6JgrF17N6WfMzF+v/9f87n33sObRR4LXPe/8C5h30XyW3vY1gGDL1N6WYhaZ+rcALF5yIzNnt9HT08Pd376DzRs3pDKXYluKnUulLUD+3/mrhx8K3kax5lJMC9R+Ls0trXz2C19h3LgmADY9tYFld9w64Hox5lJsS4y5AH16Cn3NWPeXYlpqPZf+Xw8o+Liu9VxKaYE495fccx0U/h4Q+3l3sBao/VwO//el/f2o2JZqz+Xw2+KXP/8//mflf/T5eMy5VNISay65PwMKPv/HmksxLVD7uRS7jRljLtXe3vVxVNlcrlx4NRdefCnQ97ZIYy6VtMSaS64H4j2/VNICtZ9LWs8vlbTEmAv4OBrsvht7f7qSFqj9XNLan66kJcZcIJ396Upaaj2XJ9atTW1/upKWWs+l/3Nd/4/HnEspLRD3+3Ta34/S2p/O9fhz7+Jacj0Qb3u3khao/lyKMRIgO3EiNDTAwYNkXn01f2RTIYuX3EhzSyu7dr3R5+O7d+3iy3deT8fO0k67l/vG1NH+Cj3dh14x6W0zZ7Pqv/+LzRs3MGNWG5dfsYAn1q0dMITmllbmXTS/z3VDLVN7LwdbZCrUMmNWG2tWP8KyO27lvPMv4D3zLx9wB481l2JactcvZi6VtORcdsUCGhtHB68bay7FtOSuH2MuL25/nhV3Lyv4oI05l6Factev9VyaW1pZvORG7rv33wt+g4g1l2Jacp9Xy7l0de3h6zffkP+c3HPd9m3P9rlujLkU25K7fq3vL+edfwEA1y5aSHNLK5/69D+xdcumPl8/1v2lmJbc9Ws9l8uuWMDuXbu49uaFfW6j/hsdMeZSTEvu+tWay+HfA3O3RXNLK6efMZNxTU18dvEnmTP3HBZ8+GMsva22c6mkJdZcJjW3cs11S3jm6T8VvG6suRTTAnHmMvWUvxpyGzPWXIppiTWXSc2t0bd3K2mB6s/l7X99Fl++4XomNbey8OOL2LplU8HH9OFqMZdSWmp9fwm1pPX8Um4LxJlLWs8v5bbEmktazy/ltkCcueS+Tsz96UpaIM5cIP7+dCUtEG8usfenK2mBOHNJY3+6khaIt/0CcfenK2mJNZd5F82Pvj9dSUu15zLYzzxi709X0pK7fq3nMmNWW/Tt3Upactev1lxK0QDAiBFkm5uTD3R0DHmlZXfcyr/9yxf7xB43ZgwAb3Z1lRzRsbOdz1//Dzz4wKo+H1+/9vH8N6tXO9oZ1diY/3sO99GrFvHHP/yenp6eQVvO6r3cWkbL5o0bWL/2cQBOmjKVV17eMeC6seZSTAsUP5dKWiC5k58y/VSe/tOm4HVjzaWYFogzl0nNrXR37x10IzTWXIppgThzOf2MmTz5x/WDboTGmksxLRDvcZTzzndfyIMPrBpwe8V8HA3VAvHnMqm5lVGjGgd8PI25FGqBOHOZfOIU1v8++R6wfduz9PT0DPjeGGsuxbRAdedy+PfAN7u66OnuZlJzK2edfS6/evghurr28MS6tfR0dzNt+ql9rlvtuVTSAnHmsnnjBq6/9hP52ykk1lyKaYE4cylmGzPWXKq9vVtJSxrbu5W0QHXnMrttDk/+cT0dO9vZvHEDHTvbOf2Mmak8v1TSAnHmksbzSyUtEGcuaTy/VNIC8e4vsZ9fKmmBOHOB+PvTlbRAnLmksT9dSQvEmUsa+9OVtEC8x1FOrP3pSlog/lxi7U9X0gJx5pLG/nQlLRDn5wxpbO9W0gJx5pLG9m4lLVDduZSiIfdO/pR57YVXtHKHYxVy8rRTuH3ZvSxfsTL/W9/Vklvd7djZzuIlN+Zbcn/P7367etCWUcDfAAeBR8tsWLzkRpavWAnQ5zQeacxlqJZi51KpMWPGcvkVC3jwgVXs3bu3T1/suRTTEmsuALPePoflK1aydPl9zJjVNqClkDRaYs3lpClTGT16NEuX38fyFSu5cuHVA1oKSaMl5v0FyN82uQ31tO4vQ7XEmsuaRx/hlZd3sHzFSq65bgkr/3PFgO8BhaTREmsur7y8g7POPhdINhZyv/GfxlyKaanlXObMPYdRjY1s3/Ys3d17ef2114DkqLxduzqBeI+jUltizaWQNOZSTEsacym0jVlIGi0x55Lm9m6pLbWYy0s7Xsi/n/vBc6HHdDFitaQxl0JqfX8ptyWNucR8fim3JeZc0nh+Kbcl1lzS2p8utyXm/SWN/elyW2LNJa396XJbYj/vxt6fLrcl1lzS2p8utyXWXNLany63JdbPGdLeny61JfbP6/pL8+d1g7WkOZeRuXeykyfDk08OeiTTYOf6y62yQfJk2v+Q60r0P9dg7nLGrDbecd67Wf6t2/us9IZaJj75BI1vvME6oPjdwr5yf++VC69m8ZIbWXbHrYPOpFBLNeYyWEspc6m0ZdE1i3lsza/ZvHEDs9vmDOgrJI2WmHPJrS5D8gDPHdqZxlyGaok5l8knTmFcUxM3ffY6jhszhsVLbuSpDU+kMpehWmLOJeed776Q3/z6l/n/T+v5ZbCWmHM57/wLmHzilPwh9R+9ahHbt6XzOBqqJeZcfvLAKq7/3BdZvmIlPT09/Hn3LiCd+8tQLbWcS6HzE/cXYy6ltjiXcEsacym0jVlIGi2x55LW9m6pLWl8ny5VzJZ6mkua2y+FWtKYSxrPL6W2xJ6L+9MDuT8d5v50mPvTg3N/ui/3p8Pcny6N23WDtxRyNM7l0JFMkycDgx/JVKzt255l965OJjUP/tpOQxkzZiw3feUbrP/948Eb7z3zL+ctb30bty+7l69+YykzZ7fx5a/fTnPLob831/KJbPL/P6+oKPGrhx/K95WiWnMZqqWUuVTSMmNWG29569u46hOfYvmKlVx48aVc9YlP5X+DpVixWmLNpb/c+YpDh7wOJlZLzLm88vKO/CGvHTvb6djZzoSJE0v6GrFaYt9fZsxqo6lp/KC/7T+YWC0x53LW2efmDwPOffObM/eckr5GrJaYc8m9dta1ixby9Zs/T3f3Xl7tKO17d6yWWs0l98Oyr998Q/6H0Y2No/OP4TFjxtLYODrKXMppiTmXaojVEnMuQ21jFiNWS1r3l5jbu+W01GouJ02Zmn9//AkTeP2111J7fimnJeZcqiFWS8y5pPX8Uk5LWveXmM8v5bTEmsvY48eltj9dTkta95eY+9PltMScS1r70+W0xL6/pLE/XU5LzLmktT9dTkvMuaS1P11OS8yfM6S1vVtOS1o/3y1XrJa053LoSKYTTwQgs3NnxV902vRTGdc0vuQ7Y3+XXbGArVs2sebRR4J/fviGcm4lvP+LMU6bfionNTTwvs43OAjcXWbL+z7wIZ55eiubN27In0+01B/gVGsuQ7UUO5dKWw7/jR5IfgvspR0vFLy9ConVEmsu/eVuo1LPfRmrJeZcXtrxAmedfS5rHn2E5pZWxjU15TfUixWrJfb9ZXbbHJ4PvMBjsWK1xJxL7tDx3G3U3NJa8g+1YrWk9fwy76L5Zf0GSqyWWswld2h37tQ2Oet//3j+Npoz9xzGNTXV/Hm33JaYc6mGWC0x5zLUNmYxYrXEnEsa27vlttRiLk9teILLr1jAmDFjmTb9VKZOm86rHe2pPL+U2xJzLtUQqyXmXNJ4fim3JeZc0nh+Kbcl1lzu/8FKHnrwx/nPibU/XW5LWs8vsfany22JOZc09qfLbYl9f4m9P11uS8y5pLE/XW5LWs8vsfany22J+XOGNLZ3y21J6+cv5YrVkvZc8otMuSOZBjtdXu4w8pDmllY++4WvMG5cEz09Pdz97TsqPuxq8olTmDm7jQsvvhQg/3XfM/9yoPChaf1bWm/6Z44BfgBsK7Pld79dnf+au3fv4vZ/vRkYeOqBoVqqMZd6ainkaG+ZMauNa65bwqhRo/K3UVfXnqO+Zc2jj3DSlKn5859/97578ufhPZpbgD4v+JhztLccfug4JLfR5o0bjvqWwx/Tm57akP+7j5aWk6ZMZebstvxtAcntsebRRzjr7HNZvmJltOe64dIScrS3VGsb80hrSWMbs55acqeIun3ZvX2u27GzPfiYHkrMljTmUsjR3pLGY3o4tNTTY7qeWgo52lvS2IcdDi0dO9uj78MOhxaIvw87HFrS2IcdDi1p7MPWU0shaezDDoeWQmwZKNPZ2ZkFOOYnP+G4j32M/fPm0XX//cFPHj9+fNUDau1i4GfAPuAc4I/p5kiSJEk6AmSzyfm4M5lMyiWSJEmSlJ5Dr8nUe67DTGdnajHVNgX4Tu/7t+ACkyRJkiRJkiRJUrXkF5nofeHCTHd3Wi1VNQF4iGShaTVwW7o5kiRJkiRJkiRJR5T8IlN29OjknTffTKulasYB/wvMAjYDHwD2p1okSZIkSZIkSZJ0ZDl0JNNxxwHD/0imJpIjmN4BvAhcAryeapEkSZIkSZIkSdKR59CRTL2LTMP5SKYTgF8A5wLbgXm9l5IkSZIkSZIkSaqukbl3cqfLG65HMk0Efg6cCTwHXAA8n2qRJEmSJEmSJEnSkSu/yMSxx3Jg7twUUxIZoAVoJXkdpVcY+nR3zSRHMLUBTwMXkpwqT5IkSZIkSZIkSbWR6ezszBb7yePHj696wCjgLcC7SI4+ejcwud/ndALPAM+SHJ20vfdtD3AK8HngdGALyQLTy1WvlCRJkqRDstlkNyqTyaRcIkmSJEnpGXSRaexFFzHiiSfINjbC6NG88Oqr7IWi3rqBLMmRSRlgBDAWOL73rYVkcenk3j8/XCewDRgNnAiMK+Ifsg64HGgv4nMlSZIkqRIuMkmSJEnS4afLK+TAATJdXdDVxbQaBBwgOSrpD8DDwCMkRyTlVr4ywATgtN63k4EmYHzv5evA74CVvV9LkiRJkiRJkiRJtTf06fL27yfT3Q1799L21rcyGop+y5AsFmWBgySnt9sF7CZZHHqOZIFpX/X/XZIkSZJUMx7JJEmSJEnFHMk0ciTZsWNh7FiejxAkSZIkSZIkSZKk+teQdoAkSZIkSZIkSZKGHxeZJEmSJEmSJEmSVDIXmSRJkiRJkiRJklQyF5kkSZIkSZIkSZJUMheZJEmSJEmSJEmSVDIXmSRJkiRJkiRJklQyF5kkSZIkSZIkSZJUMheZJEmSJEmSJEmSVDIXmSRJkiRJkiRJklQyF5kkSZIkSZIkSZJUspGlfHI2m61VhyRJkiQNO+4jSZIkSTqaeSSTJEmSJEmSJEmSSuYikyRJkiRJkiRJkkrmIpMkSZIkSZIkSZJK5iKTJEmSJEmSJEmSSuYikyRJkiRJkiRJkkr2/0CqqhQMFJYMAAAAAElFTkSuQmCC" alt="image-20200414194819345"></p><p>可以看到，虽然每格代表的还是半个小时，但是我们的要求应该是逢整点和半点才显示刻度的，所以起始点应该是处在12:00和12:30分两根刻度的中间才对，所以画刻度的位置就需要加上一个偏移量，这里的偏移量很明显就是12:30-12:15=15分钟，如果起始点是12:40，那么偏移量就是13:00-12:40=20分钟，那么怎么算呢？我们不妨把时间拖回到0点，从0开始也许更容易看出来：</p><p>比如间距为10，起始点为5，那么与0的偏移量当然是5，可以通过5-0也可以通过5%10来算出来，那如果起始点是14，与前一个点的偏移量是14-10=4，但问题是你不知道前一个点是多少，所以减不了，只能14%10=4来算。但是我们实际需要的是与后一个点的偏移量，很简单，间距减去它就可以了。</p><p><img src="/vue_components/assets/img/image-20200415093817468.72d4f091.png" alt="image-20200415093817468"></p><p>其实很多差距的计算都可以通过取余来算，所以：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 时间偏移量，初始时间除每格时间取余数，</span>
<span class="token keyword">let</span> msOffset <span class="token operator">=</span> msPerGrid <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp <span class="token operator">%</span> msPerGrid<span class="token punctuation">)</span>
<span class="token comment">// 距离偏移量，时间偏移量和每格时间比例乘每格像素</span>
<span class="token keyword">let</span> pxOffset <span class="token operator">=</span> <span class="token punctuation">(</span>msOffset <span class="token operator">/</span> msPerGrid<span class="token punctuation">)</span> <span class="token operator">*</span> pxPerGrid

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> gridNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> pxOffset <span class="token operator">+</span> i <span class="token operator">*</span> pxPerGrid
    <span class="token keyword">let</span> graduationTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp <span class="token operator">+</span> msOffset <span class="token operator">+</span> i <span class="token operator">*</span> msPerGrid
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>效果如下：</p><p><img src="data:image/png;base64,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" alt="image-20200415094920797"></p><p>但是这样每个刻度都显示时间没必要也有点丑，所以可以循环的时候加个判断条件来选择性的绘制，因为每种分辨率也有不同的判断条件，所以也用一个数组来表示：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 时间分辨率对应的时间显示判断条件</span>
<span class="token keyword">const</span> <span class="token constant">ZOOM_DATE_SHOW_RULE</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 全都显示</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">date</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 每五分钟显示</span>
    <span class="token keyword">return</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">===</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">date</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 显示10、20、30...分钟数</span>
    <span class="token keyword">return</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">===</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">date</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 显示整点和半点小时</span>
    <span class="token keyword">return</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">30</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">date</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 显示整点小时</span>
    <span class="token keyword">return</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">date</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 显示2、4、6...整点小时</span>
    <span class="token keyword">return</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> gridNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> pxOffset <span class="token operator">+</span> i <span class="token operator">*</span> pxPerGrid
    <span class="token keyword">let</span> graduationTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp <span class="token operator">+</span> msOffset <span class="token operator">+</span> i <span class="token operator">*</span> msPerGrid
    <span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>graduationTime<span class="token punctuation">)</span>
    <span class="token comment">// 0点显示日期</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        h <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.3</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(151,158,167,1)'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">graduationTitle</span><span class="token punctuation">(</span>graduationTime<span class="token punctuation">)</span><span class="token punctuation">,</span>
            x <span class="token operator">-</span> <span class="token number">13</span><span class="token punctuation">,</span>
            h <span class="token operator">+</span> <span class="token number">15</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">ZOOM_DATE_SHOW_RULE</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex<span class="token punctuation">]</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 其他根据判断条件来显示</span>
        h <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.2</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(151,158,167,1)'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">graduationTitle</span><span class="token punctuation">(</span>graduationTime<span class="token punctuation">)</span><span class="token punctuation">,</span>
            x <span class="token operator">-</span> <span class="token number">13</span><span class="token punctuation">,</span>
            h <span class="token operator">+</span> <span class="token number">15</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 其他不显示时间</span>
        h <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.15</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> h<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'rgba(151,158,167,1)'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>效果如下：</p><p><img src="data:image/png;base64,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" alt="image-20200415105554067"></p><h3 id="鼠标移动时显示所在时间"><a href="#鼠标移动时显示所在时间" class="header-anchor">#</a> 鼠标移动时显示所在时间</h3><p>鼠标在时间轴上滑动时需要实时显示鼠标所在位置的时间，效果如下：</p><p><img src="data:image/png;base64,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" alt="image-20200415110536750"></p><p>实现方式就是获取到鼠标相对画布的位置，然后换算成距起始点的时间：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 最开始就绑定的鼠标移动事件</span>
    <span class="token function">onMousemove</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 计算出相对画布的位置</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span> left <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> x <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> left
        <span class="token comment">// 计算出时间轴上每毫秒多少像素</span>
        <span class="token keyword">const</span> <span class="token constant">PX_PER_MS</span> <span class="token operator">=</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token constant">ZOOM</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token constant">ONE_HOUR_STAMP</span><span class="token punctuation">)</span> <span class="token comment">// px/ms</span>

        <span class="token comment">// 计算所在位置的时间</span>
        <span class="token keyword">let</span> time <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp <span class="token operator">+</span> x <span class="token operator">/</span> <span class="token constant">PX_PER_MS</span>
        <span class="token comment">// 清除画布</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearCanvas</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span>
        <span class="token comment">// 绘制</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 绘制实时的竖线及时间</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token string">'rgb(194, 202, 215)'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgb(194, 202, 215)'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>
            <span class="token function">moment</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD HH:mm:ss'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            x <span class="token operator">-</span> <span class="token number">20</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.3</span> <span class="token operator">+</span> <span class="token number">20</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="拖动时间轴"><a href="#拖动时间轴" class="header-anchor">#</a> 拖动时间轴</h3><p>万众瞩目的焦点来了，时间轴时间轴，当然得需要能拖动，不然那叫时间段，从效果上看好像是鼠标拖着时间轴在滑动，但是实际上并没有，跟动画类似，就是不断的刷新重绘，因为人眼的暂存效应，看起来就像在滑动一样，而时间轴渲染的依据就是起始时间点，所以本质上就是计算鼠标拖动过程中的起始时间点是多少，先看一下鼠标按下的事件处理函数：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">onMousedown</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> left <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 也是计算鼠标相当于时间轴左侧的距离</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mousedownX <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> left
    <span class="token comment">// 设置一下标志位</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mousedown <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token comment">// 缓存一下鼠标按下时的起始时间点</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mousedownCacheStartTimestamp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp
<span class="token punctuation">}</span>
</code></pre></div><p>鼠标开始移动就又到了鼠标移动事件处理的那个函数：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">onMousemove</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span> left <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> x <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> left
      <span class="token keyword">const</span> <span class="token constant">PX_PER_MS</span> <span class="token operator">=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token constant">ZOOM</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token constant">ONE_HOUR_STAMP</span><span class="token punctuation">)</span> <span class="token comment">// px/ms</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mousedown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 计算鼠标当前相当于鼠标按下那个点的距离</span>
        <span class="token keyword">let</span> diffX <span class="token operator">=</span> x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mousedownX
        <span class="token comment">// 用鼠标按下时的起始时间点减去拖动过程中的偏移量，往左拖是负值，减减得正，时间就是在增加，往右拖时间就是在减少</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp <span class="token operator">=</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>mousedownCacheStartTimestamp <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>diffX <span class="token operator">/</span> <span class="token constant">PX_PER_MS</span><span class="token punctuation">)</span>
        <span class="token comment">// 不断刷新重绘就ok了</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearCanvas</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
       	<span class="token comment">// 鼠标滑动显示时间的逻辑</span>
      <span class="token punctuation">}</span>
</code></pre></div><h3 id="调整时间分辨率"><a href="#调整时间分辨率" class="header-anchor">#</a> 调整时间分辨率</h3><p>调整时间分辨率说白了就是调整时间轴所表示的时间范围，我们的范围是定义在<code>ZOOM</code>数组里的，所以通过鼠标滚动来调整之前定义的变量<code>currentZoomIndex</code>，然后重新渲染画布即可，需要注意的是时间范围调整了，而时间起始点不变的话那么当前时间就会变，但是我们一般是希望当前时间是不变的，所以需要调整时要计算新的时间起始点：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">onMouseweel</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> e <span class="token operator">=</span> window<span class="token punctuation">.</span>event <span class="token operator">||</span> event
    <span class="token keyword">let</span> delta <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>wheelDelta <span class="token operator">||</span> <span class="token operator">-</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 缩小</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;=</span> <span class="token constant">ZOOM</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex <span class="token operator">=</span> <span class="token constant">ZOOM</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex<span class="token operator">++</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 放大</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex<span class="token operator">--</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearCanvas</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span>
    <span class="token comment">// 重新计算起始时间点，当前时间-新的时间范围的一半</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp <span class="token operator">=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentTime <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token constant">ZOOM</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token constant">ONE_HOUR_STAMP</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="绘制时间段"><a href="#绘制时间段" class="header-anchor">#</a> 绘制时间段</h3><p>时间段就是在时间轴里带颜色的矩形块，先看看时间段的数据结构：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        beginTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2020-06-10 09:30:00'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        endTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2020-06-10 11:20:00'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        style<span class="token operator">:</span> <span class="token punctuation">{</span>
            background<span class="token operator">:</span> <span class="token string">'#5881CF'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>接下来就是想办法把起始时间用给定的颜色在时间轴里画出来，首先要判断一下时间段是否在当前时间轴的范围内，如果不相交当然就不用画了：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>beginTime <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp <span class="token operator">+</span> <span class="token constant">ZOOM</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token constant">ONE_HOUR_STAMP</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>endTime <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 绘制范围内的线段</span>
<span class="token punctuation">}</span>
</code></pre></div><p>绘制矩形用的是<code>fillRect</code>方法，它的四个参数分别是：x、y、width、height，先算起始点的坐标，y和height可以直接根据时间轴的高度来定，所以主要计算的就是x和width，x是起点值，可以用beginTime-startTimestamp再换算成像素就可以了，需要注意的是可能beginTime小于startTimestamp，负值显然是不行的，所以转成0，width就是起始时间的差值换算成像素，也需要注意小于0的情况，完整代码如下：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">drawTimeSegments</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token constant">PX_PER_MS</span> <span class="token operator">=</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token constant">ZOOM</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token constant">ONE_HOUR_STAMP</span><span class="token punctuation">)</span> <span class="token comment">// px/ms</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timeSegments<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
            item<span class="token punctuation">.</span>beginTime <span class="token operator">&lt;=</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp <span class="token operator">+</span>
            <span class="token constant">ZOOM</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentZoomIndex<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token constant">ONE_HOUR_STAMP</span> <span class="token operator">&amp;&amp;</span>
            item<span class="token punctuation">.</span>endTime <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>beginTime <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">PX_PER_MS</span>
            <span class="token keyword">let</span> w
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                x <span class="token operator">=</span> <span class="token number">0</span>
                w <span class="token operator">=</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>endTime <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTimestamp<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">PX_PER_MS</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                w <span class="token operator">=</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>endTime <span class="token operator">-</span> item<span class="token punctuation">.</span>beginTime<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">PX_PER_MS</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background
            <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.6</span><span class="token punctuation">,</span> w<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.3</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为什么endTime大于时间轴最大时间的情况不用特殊处理呢，因为不管也没关系，反正长度都已经超出范围了，再长一点短一点也看不到。</p><p><img src="data:image/png;base64,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" alt="image-20200611201715352"></p><p>当然，这样单纯的显示一下时间段意义并不大，一般使用场景是代表在当前时间段内才有视频，所以可以在时间段存在的情况下对拖动时间做一下处理，如果拖动到的时间点不在任何一个时间段内，那么就让它吸附到离它最近的一个时间段的时间点上。</p><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3><p>没有总结~</p></div><footer class="page-edit"><!----><!----></footer><div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue_components/zh/share/3.html" class="prev">
        OpenLayers入门（一）
      </a></span><span class="next"><a href="/vue_components/zh/share/5.html">
        lerna入门
      </a>
      →
    </span></p></div></main></div><div class="global-ui"><!----></div></div>
    <script src="/vue_components/assets/js/app.2a8a8f25.js" defer></script><script src="/vue_components/assets/js/3.2c2d63e0.js" defer></script><script src="/vue_components/assets/js/12.beda9d7e.js" defer></script>
  </body>
</html>
