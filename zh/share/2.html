<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何实现一个vue组件库的在线主题编辑器 | 王林的个人博客</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="如题。">
    <link rel="preload" href="/vue_components/assets/css/0.styles.44e76d06.css" as="style"><link rel="preload" href="/vue_components/assets/js/app.2a8a8f25.js" as="script"><link rel="preload" href="/vue_components/assets/js/3.2c2d63e0.js" as="script"><link rel="preload" href="/vue_components/assets/js/23.a2bcb9ac.js" as="script"><link rel="prefetch" href="/vue_components/assets/js/10.98a59543.js"><link rel="prefetch" href="/vue_components/assets/js/11.a3f72a87.js"><link rel="prefetch" href="/vue_components/assets/js/12.beda9d7e.js"><link rel="prefetch" href="/vue_components/assets/js/13.b2d14e44.js"><link rel="prefetch" href="/vue_components/assets/js/14.c3d40cd0.js"><link rel="prefetch" href="/vue_components/assets/js/15.147456b6.js"><link rel="prefetch" href="/vue_components/assets/js/16.09e712e0.js"><link rel="prefetch" href="/vue_components/assets/js/17.c273d05b.js"><link rel="prefetch" href="/vue_components/assets/js/18.dfc13ad2.js"><link rel="prefetch" href="/vue_components/assets/js/19.e493a27d.js"><link rel="prefetch" href="/vue_components/assets/js/2.269dabf8.js"><link rel="prefetch" href="/vue_components/assets/js/20.01c1b058.js"><link rel="prefetch" href="/vue_components/assets/js/21.af94e53b.js"><link rel="prefetch" href="/vue_components/assets/js/22.3bf75fad.js"><link rel="prefetch" href="/vue_components/assets/js/24.0df4e39e.js"><link rel="prefetch" href="/vue_components/assets/js/25.69c54982.js"><link rel="prefetch" href="/vue_components/assets/js/26.9b4ba29f.js"><link rel="prefetch" href="/vue_components/assets/js/27.ee644eda.js"><link rel="prefetch" href="/vue_components/assets/js/28.caa4a1dc.js"><link rel="prefetch" href="/vue_components/assets/js/29.52c76767.js"><link rel="prefetch" href="/vue_components/assets/js/30.de768e43.js"><link rel="prefetch" href="/vue_components/assets/js/31.7915573b.js"><link rel="prefetch" href="/vue_components/assets/js/32.9c27ade0.js"><link rel="prefetch" href="/vue_components/assets/js/33.2476d2ad.js"><link rel="prefetch" href="/vue_components/assets/js/34.2335453a.js"><link rel="prefetch" href="/vue_components/assets/js/35.9ad374ff.js"><link rel="prefetch" href="/vue_components/assets/js/36.4ee74c83.js"><link rel="prefetch" href="/vue_components/assets/js/37.b32ab3f2.js"><link rel="prefetch" href="/vue_components/assets/js/38.661cdba2.js"><link rel="prefetch" href="/vue_components/assets/js/39.71b3f624.js"><link rel="prefetch" href="/vue_components/assets/js/4.f800e40a.js"><link rel="prefetch" href="/vue_components/assets/js/40.c6ccc062.js"><link rel="prefetch" href="/vue_components/assets/js/41.f15ab095.js"><link rel="prefetch" href="/vue_components/assets/js/42.1c034c68.js"><link rel="prefetch" href="/vue_components/assets/js/43.a02b503a.js"><link rel="prefetch" href="/vue_components/assets/js/44.eefc404f.js"><link rel="prefetch" href="/vue_components/assets/js/45.be81dec7.js"><link rel="prefetch" href="/vue_components/assets/js/46.40d79946.js"><link rel="prefetch" href="/vue_components/assets/js/47.94a4753a.js"><link rel="prefetch" href="/vue_components/assets/js/48.b42985d7.js"><link rel="prefetch" href="/vue_components/assets/js/49.2c2ade50.js"><link rel="prefetch" href="/vue_components/assets/js/5.cd6a39c1.js"><link rel="prefetch" href="/vue_components/assets/js/50.12afd37f.js"><link rel="prefetch" href="/vue_components/assets/js/51.c62b92d1.js"><link rel="prefetch" href="/vue_components/assets/js/52.40ef81eb.js"><link rel="prefetch" href="/vue_components/assets/js/53.aef88493.js"><link rel="prefetch" href="/vue_components/assets/js/54.b41dbe03.js"><link rel="prefetch" href="/vue_components/assets/js/55.d4fdf48f.js"><link rel="prefetch" href="/vue_components/assets/js/56.3968eef5.js"><link rel="prefetch" href="/vue_components/assets/js/57.883fcc59.js"><link rel="prefetch" href="/vue_components/assets/js/6.b5ffe322.js"><link rel="prefetch" href="/vue_components/assets/js/7.d38dc03c.js"><link rel="prefetch" href="/vue_components/assets/js/8.c70e3692.js"><link rel="prefetch" href="/vue_components/assets/js/9.b8fbaa3e.js">
    <link rel="stylesheet" href="/vue_components/assets/css/0.styles.44e76d06.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/vue_components/" class="home-link router-link-active"><!----><span class="site-name">王林的个人博客</span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><!----><ul class="sidebar-links"><li><a href="/vue_components/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/vue_components/zh/about/" class="sidebar-link">关于</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>分享</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/share/12.html" class="sidebar-link">【汉诺塔】小游戏开发教程</a></li><li><a href="/vue_components/zh/share/11.html" class="sidebar-link">OpenLayers入门（二）</a></li><li><a href="/vue_components/zh/share/1.html" class="sidebar-link">如何实现一个排序算法演示动画</a></li><li><a href="/vue_components/zh/share/2.html" aria-current="page" class="active sidebar-link">如何实现一个vue组件库的在线主题编辑器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue_components/zh/share/2.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/vue_components/zh/share/2.html#实现思路" class="sidebar-link">实现思路</a></li><li class="sidebar-sub-header"><a href="/vue_components/zh/share/2.html#主题列表页面" class="sidebar-link">主题列表页面</a></li><li class="sidebar-sub-header"><a href="/vue_components/zh/share/2.html#编辑预览页面" class="sidebar-link">编辑预览页面</a></li><li class="sidebar-sub-header"><a href="/vue_components/zh/share/2.html#后端部分" class="sidebar-link">后端部分</a></li><li class="sidebar-sub-header"><a href="/vue_components/zh/share/2.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/vue_components/zh/share/3.html" class="sidebar-link">OpenLayers入门（一）</a></li><li><a href="/vue_components/zh/share/4.html" class="sidebar-link">手摸手带你实现一个时间轴组件</a></li><li><a href="/vue_components/zh/share/5.html" class="sidebar-link">lerna入门</a></li><li><a href="/vue_components/zh/share/6.html" class="sidebar-link">Preset预设</a></li><li><a href="/vue_components/zh/share/7.html" class="sidebar-link">2的0次方为什么等于1？</a></li><li><a href="/vue_components/zh/share/8.html" class="sidebar-link">汉诺塔游戏与递归</a></li><li><a href="/vue_components/zh/share/9.html" class="sidebar-link">又一篇介绍vue3.0组合式api的文章</a></li><li><a href="/vue_components/zh/share/10.html" class="sidebar-link">浅析浏览器书签的导入和导出</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发指南</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/guide/start.html" class="sidebar-link">简介</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>PC端组件</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/web/sCharts/" class="sidebar-link">sCharts 图表组件</a></li><li><a href="/vue_components/zh/web/inRange/" class="sidebar-link">InRange 分数展示组件</a></li><li><a href="/vue_components/zh/web/asyncTreeInput/" class="sidebar-link">AsyncTreeInput 异步树输入框组件</a></li><li><a href="/vue_components/zh/web/markerImg/" class="sidebar-link">MarkerImg 带标注的图片显示组件</a></li><li><a href="/vue_components/zh/web/markImgView/" class="sidebar-link">MarkImgView 图片预览组件</a></li><li><a href="/vue_components/zh/web/mediaViewList/" class="sidebar-link">MediaViewList 媒体预览组件</a></li><li><a href="/vue_components/zh/web/processStepList/" class="sidebar-link">ProcessStepList 步骤列表组件</a></li><li><a href="/vue_components/zh/web/simpleDetail/" class="sidebar-link">SimpleDetail 简易详情组件</a></li><li><a href="/vue_components/zh/web/virtualList/" class="sidebar-link">VirtualList 虚拟列表组件</a></li><li><a href="/vue_components/zh/web/importDialog/" class="sidebar-link">ImportDialog 文件导入弹窗组件</a></li><li><a href="/vue_components/zh/web/imgUpload/" class="sidebar-link">ImgUpload 图片选择上传组件</a></li><li><a href="/vue_components/zh/web/tagCard/" class="sidebar-link">TagCard 标签选择卡片组件</a></li><li><a href="/vue_components/zh/web/mInfoList/" class="sidebar-link">MInfoList 简易信息翻页展示组件</a></li><li><a href="/vue_components/zh/web/marquee/" class="sidebar-link">Marquee 跑马灯组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>PC端mixin</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/webMixin/thDropdownMixin/" class="sidebar-link">thDropdownMixin 表头下拉菜单混入</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>APP端组件</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/app/markerImgMobile/" class="sidebar-link">MarkerImgMobile 带标注的图片预览组件</a></li><li><a href="/vue_components/zh/app/mediasMobile/" class="sidebar-link">MediasMobile 媒体组件选择预览组件</a></li><li><a href="/vue_components/zh/app/switchBtn/" class="sidebar-link">SwitchBtn 按钮组</a></li><li><a href="/vue_components/zh/app/quickInput/" class="sidebar-link">QuickInput 快速输入框</a></li><li><a href="/vue_components/zh/app/iTouch/" class="sidebar-link">ITouch 触摸拖动库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>APP端mixin</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/appMixin/stRecovery/" class="sidebar-link">stRecovery 滚动位置恢复</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>库</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/library/observer/" class="sidebar-link">Observer 发布订阅库</a></li><li><a href="/vue_components/zh/library/measure/" class="sidebar-link">OpenLayers 测距离面积</a></li><li><a href="/vue_components/zh/library/markjs/" class="sidebar-link">markjs 标注库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>代码片段</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/fragment/openlayers/" class="sidebar-link">OpenLayers 相关</a></li><li><a href="/vue_components/zh/fragment/data/" class="sidebar-link">数据相关</a></li><li><a href="/vue_components/zh/fragment/date/" class="sidebar-link">时间日期相关</a></li><li><a href="/vue_components/zh/fragment/utils/" class="sidebar-link">工具函数</a></li><li><a href="/vue_components/zh/fragment/latLon/" class="sidebar-link">坐标系转换</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>具体业务组件</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/business/cm/multiStreet/" class="sidebar-link">【CM】MultiStreet 多街道</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/others/sites/" class="sidebar-link">网址导航</a></li></ul></section></li></ul></aside><main class="page"><div class="theme-default-content content__default"><h1 id="如何实现一个vue组件库的在线主题编辑器"><a href="#如何实现一个vue组件库的在线主题编辑器" class="header-anchor">#</a> 如何实现一个vue组件库的在线主题编辑器</h1><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2><p>一般而言一个组件库都会设计一套相对来说符合大众审美或产品需求的主题，但是主题定制需求永远都存在，所以组件库一般都会允许使用者自定义主题，我司的vue组件库hui的定制主题简单来说是通过修改预定义的scss变量的值来做到的，新体系下还做到了动态换肤，因为皮肤本质上是一种静态资源（CSS文件和字体文件），所以只需要约定一种方式来每次动态请求加载不同的文件就可以了，为了方便这一需求，还配套开发了一个Vessel脚手架的插件，只需要以配置文件的方式列出你需要修改的变量和值，一个命令就可以帮你生成对应的皮肤。</p><p>但是目前的换肤还存在几个问题， 一是不直观，无法方便实时的看到修改后的组件效果，二是建议修改的变量比较少，这很大原因也是因为问题一，因为不直观所以盲目修改后的效果可能达不到预期。</p><p>针对这几个问题，所以实现一个在线主题编辑器是一个有意义的事情，目前最流行的组件库之一的Element就支持主题在线编辑，地址：https://element.eleme.cn/#/zh-CN/theme，本项目是在参考了Element的设计思想和界面效果后开发完成的，本文将开发思路分享出来，如果有一些不合理地方或有一些更好的实现方式，欢迎指出来一起讨论。</p><h2 id="实现思路"><a href="#实现思路" class="header-anchor">#</a> 实现思路</h2><p>主题在线编辑的核心其实就是以一种可视化的方式来修改主题对应scss变量的值。</p><p>项目总体分为前端和后端两个部分，前端主要负责管理主题列表、编辑主题和预览主题，后端主要负责返回变量列表和编译主题。</p><p>后端返回主题可修改的变量信息，前端生成对应的控件，用户可进行修改，修改后立即将修改的变量和修改后的值发送给后端，后端进行合并编译，生成css返回给前端，前端动态替换style标签的内容达到实时预览的效果。</p><h2 id="主题列表页面"><a href="#主题列表页面" class="header-anchor">#</a> 主题列表页面</h2><p>主题列表页面的主要功能是显示官方主题列表和显示自定义主题列表。</p><p>官方主题可进行的操作有预览和复制，不能修改，修改的话会自动生成新主题。自定义主题可以编辑和下载，及进行修改名称、复制、删除操作。</p><p>官方主题列表后端返回，数据结构如下：</p><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    name<span class="token operator">:</span> '官方主题<span class="token number">-1</span>'<span class="token punctuation">,</span> <span class="token comment">// 主题名称</span>
    by<span class="token operator">:</span> 'by hui'<span class="token punctuation">,</span> <span class="token comment">// 来源</span>
    description<span class="token operator">:</span> '默认主题'<span class="token punctuation">,</span> <span class="token comment">// 描述</span>
    theme<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 主题改动点列表</span>
        common<span class="token operator">:</span> <span class="token punctuation">{</span>
            '$--color-brand'<span class="token operator">:</span> '#e<span class="token number">72528</span>'
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>自定义主题保存在localstorage里，数据结构如下：</p><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    name<span class="token operator">:</span> name<span class="token punctuation">,</span> <span class="token comment">// 主题名称</span>
    update<span class="token operator">:</span> Date.now()<span class="token punctuation">,</span> <span class="token comment">// 最后一次修改时间</span>
    theme<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 主题改动点列表</span>
        common<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">//...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>复制主题即把要复制的主题的theme.common数据复制到新主题上即可。</p><p>需要注意的就是新建主题时要判断主题名称是否重复，因为数据结构里并没有类似id的字段。另外还有一个小问题是当预览官方主题时修改的话会自动生成新主题，所以还需要自动生成可用的主题名，实现如下：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">USER_THEME_NAME_PREFIX</span> <span class="token operator">=</span> <span class="token string">'自定义主题-'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getNextUserThemeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token comment">// 获取已经存在的自定义主题列表</span>
  <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token function">getUserThemesFromStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token constant">USER_THEME_NAME_PREFIX</span> <span class="token operator">+</span> index
  <span class="token keyword">let</span> <span class="token function-variable function">exist</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> item<span class="token punctuation">.</span>name <span class="token operator">===</span> name
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 循环检测主题名称是否重复</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">exist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    index<span class="token operator">++</span>
    name <span class="token operator">=</span> <span class="token constant">USER_THEME_NAME_PREFIX</span> <span class="token operator">+</span> index
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> name
<span class="token punctuation">}</span>
</code></pre></div><p>界面效果如下：</p><p><img src="/vue_components/assets/img/1585275422028.000663ab.png" alt="1585275422028"></p><p>因为涉及到几个页面及不同组件间的互相通信，所以vuex是必须要使用的，vuex的state要存储的内容如下：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 官方主题列表</span>
  officialThemeList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 自定义主题列表</span>
  themeList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 当前编辑中的主题id</span>
  editingTheme<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token comment">// 当前编辑的变量类型</span>
  editingActionType<span class="token operator">:</span> <span class="token string">'Color'</span><span class="token punctuation">,</span>
  <span class="token comment">// 可编辑的变量列表数据</span>
  variableList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 操作历史数据</span>
  historyIndex<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  themeHistoryList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  variableHistoryList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>editingTheme是代表当前正在编辑的名字，主题编辑时依靠这个值来修改对应主题的数据，这个值也会在localstorage里存一份。</p><p>editingActionType是代表当前正在编辑中的变量所属组件类型，主要作用是在切换要修改的组件类型后预览列表滚动到对应的组件位置及用来渲染对应主题变量对应的编辑控件，如下：</p><p><img src="data:image/png;base64,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" alt="1585275759180"></p><p>页面在vue实例化前先获取官方主题、自定义主题、最后一次编辑的主题名称，设置到vuex的store里。</p><h2 id="编辑预览页面"><a href="#编辑预览页面" class="header-anchor">#</a> 编辑预览页面</h2><p>编辑预览页面主要分两部分，左侧是组件列表，右侧是编辑区域，界面效果如下：</p><p><img src="/vue_components/assets/img/1585276503517.53b35749.png" alt="1585276503517"></p><h3 id="组件预览区域"><a href="#组件预览区域" class="header-anchor">#</a> 组件预览区域</h3><p>组件预览区域很简单，无脑罗列出所有组件库里的组件，就像这样：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Color</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Color</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Radio</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Radio</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Checkbox</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Checkbox</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Inputer</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Inputer</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Autocomplete</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Autocomplete</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InputNumber</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>InputNumber</span><span class="token punctuation">&gt;</span></span>
    //...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>同时需要监听一下editingActionType值的变化来滚动到对应组件的位置：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token punctuation">{</span>
    watch<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'$store.state.editingActionType'</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token string">'Input'</span><span class="token operator">:</span>
                    id <span class="token operator">=</span> <span class="token string">'Inputer'</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> item<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_componentTag <span class="token operator">===</span> id
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>component<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> el <span class="token operator">=</span> component<span class="token punctuation">.</span>_vnode<span class="token punctuation">.</span>elm
                <span class="token keyword">let</span> top <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>top <span class="token operator">+</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop
                document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> top <span class="token operator">-</span> <span class="token number">20</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="编辑区域"><a href="#编辑区域" class="header-anchor">#</a> 编辑区域</h3><p>编辑区域主要分为三部分，工具栏、选择栏、控件区。这部分是本项目的核心也是最复杂的一部分。</p><p>先看一下变量列表的数据结构：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Color&quot;</span><span class="token punctuation">,</span><span class="token comment">// 组件类型/类别</span>
    <span class="token string">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token comment">// 配置列表</span>
        <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;color&quot;</span><span class="token punctuation">,</span><span class="token comment">// 变量类型，根据此字段渲染对应类型的控件</span>
        <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;$--color-brand&quot;</span><span class="token punctuation">,</span><span class="token comment">// sass变量名</span>
        <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#e72528&quot;</span><span class="token punctuation">,</span><span class="token comment">// sass变量对应的值，可以是具体的值，也可以是sass变量名</span>
        <span class="token string">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Brand Color&quot;</span><span class="token comment">// 列表，用来分组进行显示</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此列表是后端返回的，选择器的选项是遍历该列表取出所有的name字段的值而组成的。</p><p><img src="data:image/png;base64,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" alt="1585278444165"></p><p>因为有些变量的值是依赖另一个变量的，所依赖的变量也有可能还依赖另一个变量，所以需要对数据进行处理，替换成变量最终的值，实现方式就是循环遍历数据，这就要求所有被依赖的变量也存在于这个列表中，否则就找不到了，只能显示变量名，所以这个实现方式其实是有待商榷的，因为有些被依赖的变量它可能并不需要或不能可编辑，本项目目前版本是存在此问题的。</p><p>此外还需要和当前编辑中的主题变量的值进行合并，处理如下：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Editor组件</span>
<span class="token keyword">async</span> <span class="token function">getVariable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取变量列表，res.data就是变量列表，数据结构上面已经提到了</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getVariable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 和当前主题变量进行合并</span>
        <span class="token keyword">let</span> curTheme <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getUserThemeByNameFromStore</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>editingTheme<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment">// 合并</span>
        list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">,</span> curTheme<span class="token punctuation">.</span>theme<span class="token punctuation">)</span>

        <span class="token comment">// 变量进行替换处理，因为目前存在该情况的只有颜色类型的变量，所以为了执行效率加上该过滤条件</span>
        list <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">replaceVariable</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'color'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment">// 排序</span>
        list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sortVariable</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>variableList <span class="token operator">=</span> list

        <span class="token comment">// 存储到vuex</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'updateVariableList'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>variableList<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>merge方法就是遍历合并对应变量key的值，主要看replaceVariable方法：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">replaceVariable</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> types</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 遍历整体变量列表</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>config
    <span class="token comment">// 遍历某个类别下的变量列表</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果不在替换类型范围内的和值不是变量的话就跳过</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>types<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">checkVariable</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span>
      <span class="token punctuation">}</span>
        <span class="token comment">// 替换处理</span>
      arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">findVariableReplaceValue</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> data
<span class="token punctuation">}</span>
</code></pre></div><p>findVariableReplaceValue方法通过递归进行查找：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">findVariableReplaceValue</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>config
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>key <span class="token operator">===</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 如果不是变量的话就是最终的值，返回就好了</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">checkVariable</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>value
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 如果还是变量的话就递归查找</span>
          <span class="token keyword">return</span> <span class="token function">findVariableReplaceValue</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来是具体的控件显示逻辑，根据当前编辑中的类型对应的配置数据进行渲染，模板如下：</p><div class="language-vue extra-class"><pre class="language-vue"><code>// Editor组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>editorContainer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>editorBlock<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>items in data<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>items.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>editorBlockTitle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{items.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>editorList<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>editorItem<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item in items.list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item.key<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>editorItemTitle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{parseName(item.key)}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Control</span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>valueChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Control</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>data是对应变量类型里的config数据，是个计算属性：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    computed<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 找出当前编辑中的变量类别</span>
            <span class="token keyword">let</span> _data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>variableList<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> item<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>editingActionType
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">let</span> config <span class="token operator">=</span> _data<span class="token punctuation">.</span>config
            <span class="token comment">// 进行分组</span>
            <span class="token keyword">let</span> categorys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            config<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> category <span class="token operator">=</span> categorys<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> c<span class="token punctuation">.</span>name <span class="token operator">===</span> item<span class="token punctuation">.</span>category
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>category<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    categorys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        name<span class="token operator">:</span> item<span class="token punctuation">.</span>category<span class="token punctuation">,</span>
                        list<span class="token operator">:</span> <span class="token punctuation">[</span>item<span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span>
                category<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> categorys
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Control是具体的控件显示组件，某个变量具体是用输入框还是下拉列表都在这个组件内进行判断，核心是使用component动态组件：</p><div class="language-vue extra-class"><pre class="language-vue"><code>// Control组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>controlContainer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>showComponent<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>data<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>data.value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>emitChange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:extraColorList</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>extraColors<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// 控件类型映射</span>
<span class="token keyword">const</span> componentMap <span class="token operator">=</span> <span class="token punctuation">{</span>
  color<span class="token operator">:</span> <span class="token string">'ColorPicker'</span><span class="token punctuation">,</span>
  select<span class="token operator">:</span> <span class="token string">'Selecter'</span><span class="token punctuation">,</span>
  input<span class="token operator">:</span> <span class="token string">'Inputer'</span><span class="token punctuation">,</span>
  shadow<span class="token operator">:</span> <span class="token string">'Shadow'</span><span class="token punctuation">,</span>
  fontSize<span class="token operator">:</span> <span class="token string">'Selecter'</span><span class="token punctuation">,</span>
  fontWeight<span class="token operator">:</span> <span class="token string">'Selecter'</span><span class="token punctuation">,</span>
  fontLineHeight<span class="token operator">:</span> <span class="token string">'Selecter'</span><span class="token punctuation">,</span>
  borderRadius<span class="token operator">:</span> <span class="token string">'Selecter'</span><span class="token punctuation">,</span>
  height<span class="token operator">:</span> <span class="token string">'Inputer'</span><span class="token punctuation">,</span>
  padding<span class="token operator">:</span> <span class="token string">'Inputer'</span><span class="token punctuation">,</span>
  width<span class="token operator">:</span> <span class="token string">'Inputer'</span>
<span class="token punctuation">}</span>
<span class="token punctuation">{</span>
    computed<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">showComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 根据变量类型来显示对应的控件</span>
            <span class="token keyword">return</span> componentMap<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>type<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>一共有颜色选择组件、输入框组件、选择器组件、阴影编辑组件，具体实现很简单就不细说了，大概就是显示初始传入的变量，然后修改后触发修改事件change，经Control组件传递到Editor组件，在Editor组件上进行变量修改及发送编译请求，不过其中阴影组件的实现折磨了我半天，主要是如何解析阴影数据，这里用的是很暴力的一种解析方法，如果有更好的解析方式的话可以留言进行分享：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 解析css阴影数据</span>
<span class="token comment">// 因为rgb颜色值内也存在逗号，所以就不能简单的用逗号进行切割解析</span>
<span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 解析成复合值数组</span>
    <span class="token comment">//   let value = &quot;0 0 2px 0 #666,0 0 2px 0 #666, 0 2px 4px 0 rgba(0, 0, 0, 0.12), 0 2px 4px 0 hlsa(0, 0, 0, 0.12),0 2px 4px 0 #sdf, 0 2px 4px 0 hlsa(0, 0, 0, 0.12), 0 2px 0 hlsa(0, 0, 0, 0.12), 0 2px hlsa(0, 0, 0, 0.12), 0 2px 4px 0 hlsa(0, 0, 0, 0.12)&quot;</span>
    <span class="token comment">// 根据右括号来进行分割成数组</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\)\s*,\s*/gim</span><span class="token punctuation">)</span>
    arr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 补上右括号</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>item<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> item <span class="token operator">+</span> <span class="token string">')'</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 非rgb颜色值的直接返回</span>
            <span class="token keyword">return</span> item
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> farr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> quene <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">let</span> hasBrackets <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token comment">// 逐个字符进行遍历</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> item<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 遇到非颜色值内的逗号直接拼接目前队列里的字符添加到数组</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">','</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>hasBrackets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                farr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>quene<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                quene <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'('</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//遇到颜色值的左括号修改标志位</span>
                hasBrackets <span class="token operator">=</span> <span class="token boolean">true</span>
                quene<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">')'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//遇到右括号重置标志位</span>
                hasBrackets <span class="token operator">=</span> <span class="token boolean">false</span>
                quene<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 其他字符直接添加到队列里</span>
                quene<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 添加队列剩余的数据</span>
        farr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>quene<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 解析出单个属性</span>
    <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    farr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> colorRegs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token regex">/#[a-zA-Z0-9]{3,6}$/</span><span class="token punctuation">,</span> <span class="token regex">/rgba?\([^()]+\)$/gim</span><span class="token punctuation">,</span> <span class="token regex">/hlsa?\([^()]+\)$/gim</span><span class="token punctuation">,</span> <span class="token regex">/\s+[a-zA-z]+$/</span><span class="token punctuation">]</span>
        <span class="token keyword">let</span> last <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">let</span> color <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> colorRegs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> reg <span class="token operator">=</span> colorRegs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">let</span> result <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                color <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                last <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> props <span class="token operator">=</span> last<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\s+/</span><span class="token punctuation">)</span>
        list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            xpx<span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>props<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ypx<span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>props<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            spread<span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>props<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
            blur<span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>props<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
            color
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list
<span class="token punctuation">}</span>
</code></pre></div><p>回到Editor组件，编辑控件触发了修改事件后需要更新变量列表里面对应的值及对应主题列表里面的值，同时要发送编译请求：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// data是变量里config数组里的一项，value就是修改后的值</span>
<span class="token keyword">function</span> <span class="token function">valueChange</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 更新当前变量对应key的值</span>
    <span class="token keyword">let</span> cloneData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>variableList<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> tarData <span class="token operator">=</span> cloneData<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>editingActionType
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    tarData<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>key <span class="token operator">===</span> data<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            item<span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 因为是支持颜色值修改为某些变量的，所以要重新进行变量替换处理</span>
    cloneData <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">replaceVariable</span><span class="token punctuation">(</span>cloneData<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'color'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'updateVariableList'</span><span class="token punctuation">,</span> cloneData<span class="token punctuation">)</span>
    <span class="token comment">// 更新当前主题</span>
    <span class="token keyword">let</span> curTheme <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getUserThemeByNameFromStore</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>editingTheme<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>curTheme<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 当前是官方主题则创建新主题</span>
        <span class="token keyword">let</span> theme <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">createNewUserTheme</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token punctuation">[</span>data<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token operator">:</span> value
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'updateEditingTheme'</span><span class="token punctuation">,</span> theme<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 修改的是自定义主题</span>
        curTheme<span class="token punctuation">.</span>theme<span class="token punctuation">.</span>common <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span>curTheme<span class="token punctuation">.</span>theme<span class="token punctuation">.</span>common<span class="token punctuation">,</span>
            <span class="token punctuation">[</span>data<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token operator">:</span> value
        <span class="token punctuation">}</span>
        store<span class="token punctuation">.</span><span class="token function">updateUserTheme</span><span class="token punctuation">(</span>curTheme<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            theme<span class="token operator">:</span> curTheme<span class="token punctuation">.</span>theme
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 请求编译</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateVariable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来是发送编译请求：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">updateVariable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> curTheme <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getUserThemeByNameFromStore</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>editingTheme<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">updateVariable</span><span class="token punctuation">(</span>curTheme<span class="token punctuation">.</span>theme<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">replaceTheme</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>参数为当前主题修改的变量数据，后端编译完后返回css字符串，需要动态插入到head标签里：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">replaceTheme</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token string">'HUI_PREVIEW_THEME'</span>
    <span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#'</span> <span class="token operator">+</span> id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> data
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span>
        el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> data
        el<span class="token punctuation">.</span>id <span class="token operator">=</span> id
        document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样就达到了修改变量后实时预览的效果，下载主题也是类似，把当前编辑的主题的数据发送给后端编译完后生成压缩包进行下载。</p><p>下载：因为要发送主题变量进行编译下载，所以不能使用get方法，但使用post方法进行下载比较麻烦，所以为了简单起见，下载操作实际是在浏览器端做的。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">downloadTheme</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token operator">:</span> <span class="token string">'/api/v1/download'</span><span class="token punctuation">,</span>
        method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        responseType<span class="token operator">:</span> <span class="token string">'blob'</span><span class="token punctuation">,</span> <span class="token comment">// important</span>
        data
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>response<span class="token punctuation">.</span>data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
        link<span class="token punctuation">.</span>href <span class="token operator">=</span> url
        link<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'download'</span><span class="token punctuation">,</span> <span class="token string">'theme.zip'</span><span class="token punctuation">)</span>
        link<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>至此，主流程已经跑通，接下来是一些提升体验的功能。</p><p>1.重置功能：重置理应是重置到某个主题复制来源的那个主题的，但是其实必要性也不是特别大，所以就简单做，直接把当前主题的配置变量清空，即theme.common={}，同时需要重新请求变量数据及请求编译。</p><p>2.前进回退功能：前进回退功能说白了就是把每一步操作的数据都克隆一份并存到一个数组里，然后设置一个指针，比如index，指向当前所在的位置，前进就是index++，后退就是index--，然后取出对应数组里的数据替换当前的数据。对于本项目，需要存两个东西，一个是主题数据，一个是变量数据。可以通过对象形式存到一个数组里，也可以向本项目一样搞两个数组。</p><p>具体实现：</p><p>1.先把初始的主题数据拷贝一份扔进历史数组themeHistoryList里，请求到变量数据后扔进variableHistoryList数组里</p><p>2.每次修改后把修改后的变量数据和主题数据都复制一份扔进去，同时指针historyIndex加1</p><p>3.根据前进还是回退来设置historyIndex的值，同时取出对应位置的主题和变量数据替换当前的数据，然后请求编译</p><p>需要注意的是在重置和返回主题列表页面时要复位themeHistoryList、variableHistoryList、historyIndex</p><p>3.颜色预览组件优化</p><p><img src="/vue_components/assets/img/1585290103456.f44e995c.png" alt="1585290103456"></p><p>因为颜色预览组件是需要显示当前颜色和颜色值的，那么就会有一个问题，字体颜色不能写死，否则如果字体写死白色，那么如果这个变量的颜色值又修改成白色，那么将一片白色，啥也看不见，所以需要动态判断是用黑色还是白色，有兴趣详细了解判断算法可阅读：https://segmentfault.com/a/1190000018907560。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token keyword">const</span> <span class="token function-variable function">getContrastYIQ</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">hexcolor</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  hexcolor <span class="token operator">=</span> <span class="token function">colorToHEX</span><span class="token punctuation">(</span>hexcolor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>hexcolor<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>hexcolor<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>hexcolor<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> yiq <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">*</span> <span class="token number">299</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>g <span class="token operator">*</span> <span class="token number">587</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>b <span class="token operator">*</span> <span class="token number">114</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>yiq <span class="token operator">&gt;=</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'black'</span> <span class="token operator">:</span> <span class="token string">'white'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>colorToHEX是一个将各种类型的颜色值都转为十六进制颜色的函数。</p><p>4.一些小细节</p><p>logo、导航、返回按钮、返回顶部等小控件随当前编辑中的主题色进行变色。</p><p>到这里前端部分就结束了，让我们喝口水继续。</p><h2 id="后端部分"><a href="#后端部分" class="header-anchor">#</a> 后端部分</h2><p>后端用的是nodejs及eggjs框架，对eggjs不熟悉的话可先阅读一下文档：https://eggjs.org/zh-cn/，后端部分比较简单，先看路由：</p><div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> router<span class="token punctuation">,</span> controller <span class="token punctuation">}</span> <span class="token operator">=</span> app

  <span class="token comment">// 获取官方主题列表</span>
  router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BASE_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/getOfficialThemes</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>index<span class="token punctuation">.</span>getOfficialThemes<span class="token punctuation">)</span>

  <span class="token comment">// 返回变量数据</span>
  router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BASE_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/getVariable</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>index<span class="token punctuation">.</span>getVariable<span class="token punctuation">)</span>

  <span class="token comment">// 编译scss</span>
  router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BASE_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/updateVariable</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>index<span class="token punctuation">.</span>updateVariable<span class="token punctuation">)</span>

  <span class="token comment">// 下载</span>
  router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BASE_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/download</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>index<span class="token punctuation">.</span>download<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>目前官方主题列表和变量数据都是一个写死的json文件。所以核心只有两部分，编译scss和下载，先看编译。</p><h3 id="编译scss"><a href="#编译scss" class="header-anchor">#</a> 编译scss</h3><p>主题在线编辑能实现靠的就是scss的变量功能，编译scss可用使用sass包或者node-sass包，前端传过来的参数其实就一个json类型的对象，key是变量，value是值，但是这两个包都不支持传入额外的变量数据和本地的scss文件进行合并编译，但是提供了一个配置项：importer，可以传入函数数组，它会在编译过程中遇到 <code>@use</code> or <code>@import</code>语法时执行这个函数，入参为url，可以返回一个对象：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    contents<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    h1 {
    font-size: 40px;
    }
	</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre></div><p>contents的内容即会替代原本要引入的对应scss文件的内容，详情请看：https://sass-lang.com/documentation/js-api#importer。</p><p>但是实际使用过程中，不知为何sass包的这个配置项是无效的，所以只能使用node-sass，这两个包的api基本是一样的，但是node-sass安装起来比较麻烦，尤其是windows上，安装方法大致有两种：</p><ol><li></li></ol><div class="language- extra-class"><pre class="language-text"><code>npm install -g node-gyp
npm install --global --production windows-build-tools
npm install node-sass --save-dev
</code></pre></div><ol start="2"><li></li></ol><div class="language- extra-class"><pre class="language-text"><code>npm install -g cnpm --registry=https://registry.npm.taobao.org
cnpm install node-sass
</code></pre></div><p>因为主题的变量定义一般都在统一的一个或几个文件内，像hui，是定义在var-common.scss和var.scss两个文件内，所以可以读取这两个文件的内容然后将其中对应变量的值替换为前端传过来的变量，替换完成后通过importer函数返回进行编译，具体替换方式也有多种，我同事的方法是自己写了个scss解析器，解析成对象，然后遍历对象解析替换，而我，比较草率，直接用正则匹配解析修改，实现如下：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 前端传递过来的数据</span>
    <span class="token keyword">let</span> updates <span class="token operator">=</span> data<span class="token punctuation">.</span>common
    <span class="token comment">// 两个文件的路径</span>
    <span class="token keyword">let</span> commonScssPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'node_modules/hui/packages/theme/common/var-common.scss'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> varScssPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'node_modules/hui/packages/theme/common/var.scss'</span><span class="token punctuation">)</span>
    <span class="token comment">// 读取两个文件的内容</span>
    <span class="token keyword">let</span> commonScssContent <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>commonScssPath<span class="token punctuation">,</span> <span class="token punctuation">{</span>encoding<span class="token operator">:</span> <span class="token string">'utf8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> varScssContent <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>varScssPath<span class="token punctuation">,</span> <span class="token punctuation">{</span>encoding<span class="token operator">:</span> <span class="token string">'utf8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 遍历要修改的变量数据</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>updates<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> _key <span class="token operator">=</span> key
        <span class="token comment">// 正则匹配及替换</span>
        key <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">'\\$'</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> reg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'('</span> <span class="token operator">+</span>key <span class="token operator">+</span> <span class="token string">'\\s*:\\s*)([^:]+)(;)'</span><span class="token punctuation">,</span> <span class="token string">'img'</span><span class="token punctuation">)</span>
        commonScssContent <span class="token operator">=</span> commonScssContent<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$1</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>updates<span class="token punctuation">[</span>_key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">$3</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        varScssContent <span class="token operator">=</span> varScssContent<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$1</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>updates<span class="token punctuation">[</span>_key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">$3</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 修改路径为绝对路径，否则会报错</span>
    <span class="token keyword">let</span> mixinsPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'node_modules/hui/packages/theme/mixins/_color-helpers.scss'</span><span class="token punctuation">)</span>
    mixinsPath <span class="token operator">=</span> mixinsPath<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
    commonScssContent <span class="token operator">=</span> commonScssContent<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@import '../mixins/_color-helpers'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@import '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mixinsPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> huiScssPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'node_modules/hui/packages/theme/index.scss'</span><span class="token punctuation">)</span>
	<span class="token comment">// 编译scss</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> sass<span class="token punctuation">.</span><span class="token function">renderSync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        file<span class="token operator">:</span> huiScssPath<span class="token punctuation">,</span>
        importer<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'var-common'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token punctuation">{</span>
                        contents<span class="token operator">:</span> commonScssContent
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'var'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token punctuation">{</span>
                        contents<span class="token operator">:</span> varScssContent
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token keyword">null</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result<span class="token punctuation">.</span>css<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="下载主题"><a href="#下载主题" class="header-anchor">#</a> 下载主题</h3><p>下载的主题包里有两个数据，一个是配置源文件，另一个就是编译后的主题包，包括css文件和字体文件。创建压缩包使用的是jszip，可参考：https://github.com/Stuk/jszip。</p><p>主题包的目录结构如下：</p><div class="language- extra-class"><pre class="language-text"><code>-theme
--fonts
--index.css
-config.json
</code></pre></div><p>实现如下：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token function">createThemeZip</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> zip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSZip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 配置源文件</span>
    zip<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'config.json'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>common<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 编译后的css主题包</span>
    <span class="token keyword">let</span> theme <span class="token operator">=</span> zip<span class="token punctuation">.</span><span class="token function">folder</span><span class="token punctuation">(</span><span class="token string">'theme'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> fontPath <span class="token operator">=</span> <span class="token string">'node_modules/hui/packages/theme/fonts'</span>
    <span class="token keyword">let</span> fontsFolder <span class="token operator">=</span> theme<span class="token punctuation">.</span><span class="token function">folder</span><span class="token punctuation">(</span><span class="token string">'fonts'</span><span class="token punctuation">)</span>
    <span class="token comment">// 遍历添加字体文件</span>
    <span class="token keyword">let</span> <span class="token function-variable function">loopAdd</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">_path<span class="token punctuation">,</span> folder</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>_path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> curPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>_path<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> newFolder <span class="token operator">=</span> folder<span class="token punctuation">.</span><span class="token function">folder</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
          <span class="token function">loopAdd</span><span class="token punctuation">(</span>curPath<span class="token punctuation">,</span> newFolder<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          folder<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">loopAdd</span><span class="token punctuation">(</span>fontPath<span class="token punctuation">,</span> fontsFolder<span class="token punctuation">)</span>
    <span class="token comment">// 编译后的css</span>
    <span class="token keyword">let</span> css <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">huiComplier</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    theme<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'index.css'</span><span class="token punctuation">,</span> css<span class="token punctuation">)</span>
    <span class="token comment">// 压缩</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> zip<span class="token punctuation">.</span><span class="token function">generateAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'nodebuffer'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 保存到本地</span>
    <span class="token comment">// fs.writeFileSync('theme.zip', result, (err) =&gt; {</span>
    <span class="token comment">//   if (err){</span>
    <span class="token comment">//     this.ctx.logger.warn('压缩失败', err)</span>
    <span class="token comment">//   }</span>
    <span class="token comment">//   this.ctx.logger.info('压缩完成')</span>
    <span class="token comment">// })</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span>
</code></pre></div><p>至此，前端和后端的核心实现都已介绍完毕。</p><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2><p>本项目目前只是一个粗糙的实现，旨在提供一个实现思路，还有很多细节需要优化，比如之前提到的变量依赖问题，还有scss的解析合并方式，此外还有多语言、多版本的问题需要考虑。</p></div><footer class="page-edit"><!----><!----></footer><div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue_components/zh/share/1.html" class="prev">
        如何实现一个排序算法演示动画
      </a></span><span class="next"><a href="/vue_components/zh/share/3.html">
        OpenLayers入门（一）
      </a>
      →
    </span></p></div></main></div><div class="global-ui"><!----></div></div>
    <script src="/vue_components/assets/js/app.2a8a8f25.js" defer></script><script src="/vue_components/assets/js/3.2c2d63e0.js" defer></script><script src="/vue_components/assets/js/23.a2bcb9ac.js" defer></script>
  </body>
</html>
