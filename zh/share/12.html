<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【汉诺塔】小游戏开发教程 | 王林的个人博客</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="如题。">
    <link rel="preload" href="/vue_components/assets/css/0.styles.44e76d06.css" as="style"><link rel="preload" href="/vue_components/assets/js/app.2a8a8f25.js" as="script"><link rel="preload" href="/vue_components/assets/js/3.2c2d63e0.js" as="script"><link rel="preload" href="/vue_components/assets/js/52.40ef81eb.js" as="script"><link rel="prefetch" href="/vue_components/assets/js/10.98a59543.js"><link rel="prefetch" href="/vue_components/assets/js/11.a3f72a87.js"><link rel="prefetch" href="/vue_components/assets/js/12.beda9d7e.js"><link rel="prefetch" href="/vue_components/assets/js/13.b2d14e44.js"><link rel="prefetch" href="/vue_components/assets/js/14.c3d40cd0.js"><link rel="prefetch" href="/vue_components/assets/js/15.147456b6.js"><link rel="prefetch" href="/vue_components/assets/js/16.09e712e0.js"><link rel="prefetch" href="/vue_components/assets/js/17.c273d05b.js"><link rel="prefetch" href="/vue_components/assets/js/18.dfc13ad2.js"><link rel="prefetch" href="/vue_components/assets/js/19.e493a27d.js"><link rel="prefetch" href="/vue_components/assets/js/2.269dabf8.js"><link rel="prefetch" href="/vue_components/assets/js/20.01c1b058.js"><link rel="prefetch" href="/vue_components/assets/js/21.af94e53b.js"><link rel="prefetch" href="/vue_components/assets/js/22.3bf75fad.js"><link rel="prefetch" href="/vue_components/assets/js/23.a2bcb9ac.js"><link rel="prefetch" href="/vue_components/assets/js/24.0df4e39e.js"><link rel="prefetch" href="/vue_components/assets/js/25.69c54982.js"><link rel="prefetch" href="/vue_components/assets/js/26.9b4ba29f.js"><link rel="prefetch" href="/vue_components/assets/js/27.ee644eda.js"><link rel="prefetch" href="/vue_components/assets/js/28.caa4a1dc.js"><link rel="prefetch" href="/vue_components/assets/js/29.52c76767.js"><link rel="prefetch" href="/vue_components/assets/js/30.de768e43.js"><link rel="prefetch" href="/vue_components/assets/js/31.7915573b.js"><link rel="prefetch" href="/vue_components/assets/js/32.9c27ade0.js"><link rel="prefetch" href="/vue_components/assets/js/33.2476d2ad.js"><link rel="prefetch" href="/vue_components/assets/js/34.2335453a.js"><link rel="prefetch" href="/vue_components/assets/js/35.9ad374ff.js"><link rel="prefetch" href="/vue_components/assets/js/36.4ee74c83.js"><link rel="prefetch" href="/vue_components/assets/js/37.b32ab3f2.js"><link rel="prefetch" href="/vue_components/assets/js/38.661cdba2.js"><link rel="prefetch" href="/vue_components/assets/js/39.71b3f624.js"><link rel="prefetch" href="/vue_components/assets/js/4.f800e40a.js"><link rel="prefetch" href="/vue_components/assets/js/40.c6ccc062.js"><link rel="prefetch" href="/vue_components/assets/js/41.f15ab095.js"><link rel="prefetch" href="/vue_components/assets/js/42.1c034c68.js"><link rel="prefetch" href="/vue_components/assets/js/43.a02b503a.js"><link rel="prefetch" href="/vue_components/assets/js/44.eefc404f.js"><link rel="prefetch" href="/vue_components/assets/js/45.be81dec7.js"><link rel="prefetch" href="/vue_components/assets/js/46.40d79946.js"><link rel="prefetch" href="/vue_components/assets/js/47.94a4753a.js"><link rel="prefetch" href="/vue_components/assets/js/48.b42985d7.js"><link rel="prefetch" href="/vue_components/assets/js/49.2c2ade50.js"><link rel="prefetch" href="/vue_components/assets/js/5.cd6a39c1.js"><link rel="prefetch" href="/vue_components/assets/js/50.12afd37f.js"><link rel="prefetch" href="/vue_components/assets/js/51.c62b92d1.js"><link rel="prefetch" href="/vue_components/assets/js/53.aef88493.js"><link rel="prefetch" href="/vue_components/assets/js/54.b41dbe03.js"><link rel="prefetch" href="/vue_components/assets/js/55.d4fdf48f.js"><link rel="prefetch" href="/vue_components/assets/js/56.3968eef5.js"><link rel="prefetch" href="/vue_components/assets/js/57.883fcc59.js"><link rel="prefetch" href="/vue_components/assets/js/6.b5ffe322.js"><link rel="prefetch" href="/vue_components/assets/js/7.d38dc03c.js"><link rel="prefetch" href="/vue_components/assets/js/8.c70e3692.js"><link rel="prefetch" href="/vue_components/assets/js/9.b8fbaa3e.js">
    <link rel="stylesheet" href="/vue_components/assets/css/0.styles.44e76d06.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/vue_components/" class="home-link router-link-active"><!----><span class="site-name">王林的个人博客</span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><!----><ul class="sidebar-links"><li><a href="/vue_components/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/vue_components/zh/about/" class="sidebar-link">关于</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>分享</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/share/12.html" aria-current="page" class="active sidebar-link">【汉诺塔】小游戏开发教程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue_components/zh/share/12.html#游戏简介" class="sidebar-link">游戏简介</a></li><li class="sidebar-sub-header"><a href="/vue_components/zh/share/12.html#布局" class="sidebar-link">布局</a></li><li class="sidebar-sub-header"><a href="/vue_components/zh/share/12.html#拖动" class="sidebar-link">拖动</a></li><li class="sidebar-sub-header"><a href="/vue_components/zh/share/12.html#完成检测" class="sidebar-link">完成检测</a></li><li class="sidebar-sub-header"><a href="/vue_components/zh/share/12.html#动画过度" class="sidebar-link">动画过度</a></li><li class="sidebar-sub-header"><a href="/vue_components/zh/share/12.html#最少步数与自动操作" class="sidebar-link">最少步数与自动操作</a></li><li class="sidebar-sub-header"><a href="/vue_components/zh/share/12.html#返回上一步" class="sidebar-link">返回上一步</a></li></ul></li><li><a href="/vue_components/zh/share/11.html" class="sidebar-link">OpenLayers入门（二）</a></li><li><a href="/vue_components/zh/share/1.html" class="sidebar-link">如何实现一个排序算法演示动画</a></li><li><a href="/vue_components/zh/share/2.html" class="sidebar-link">如何实现一个vue组件库的在线主题编辑器</a></li><li><a href="/vue_components/zh/share/3.html" class="sidebar-link">OpenLayers入门（一）</a></li><li><a href="/vue_components/zh/share/4.html" class="sidebar-link">手摸手带你实现一个时间轴组件</a></li><li><a href="/vue_components/zh/share/5.html" class="sidebar-link">lerna入门</a></li><li><a href="/vue_components/zh/share/6.html" class="sidebar-link">Preset预设</a></li><li><a href="/vue_components/zh/share/7.html" class="sidebar-link">2的0次方为什么等于1？</a></li><li><a href="/vue_components/zh/share/8.html" class="sidebar-link">汉诺塔游戏与递归</a></li><li><a href="/vue_components/zh/share/9.html" class="sidebar-link">又一篇介绍vue3.0组合式api的文章</a></li><li><a href="/vue_components/zh/share/10.html" class="sidebar-link">浅析浏览器书签的导入和导出</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发指南</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/guide/start.html" class="sidebar-link">简介</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>PC端组件</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/web/sCharts/" class="sidebar-link">sCharts 图表组件</a></li><li><a href="/vue_components/zh/web/inRange/" class="sidebar-link">InRange 分数展示组件</a></li><li><a href="/vue_components/zh/web/asyncTreeInput/" class="sidebar-link">AsyncTreeInput 异步树输入框组件</a></li><li><a href="/vue_components/zh/web/markerImg/" class="sidebar-link">MarkerImg 带标注的图片显示组件</a></li><li><a href="/vue_components/zh/web/markImgView/" class="sidebar-link">MarkImgView 图片预览组件</a></li><li><a href="/vue_components/zh/web/mediaViewList/" class="sidebar-link">MediaViewList 媒体预览组件</a></li><li><a href="/vue_components/zh/web/processStepList/" class="sidebar-link">ProcessStepList 步骤列表组件</a></li><li><a href="/vue_components/zh/web/simpleDetail/" class="sidebar-link">SimpleDetail 简易详情组件</a></li><li><a href="/vue_components/zh/web/virtualList/" class="sidebar-link">VirtualList 虚拟列表组件</a></li><li><a href="/vue_components/zh/web/importDialog/" class="sidebar-link">ImportDialog 文件导入弹窗组件</a></li><li><a href="/vue_components/zh/web/imgUpload/" class="sidebar-link">ImgUpload 图片选择上传组件</a></li><li><a href="/vue_components/zh/web/tagCard/" class="sidebar-link">TagCard 标签选择卡片组件</a></li><li><a href="/vue_components/zh/web/mInfoList/" class="sidebar-link">MInfoList 简易信息翻页展示组件</a></li><li><a href="/vue_components/zh/web/marquee/" class="sidebar-link">Marquee 跑马灯组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>PC端mixin</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/webMixin/thDropdownMixin/" class="sidebar-link">thDropdownMixin 表头下拉菜单混入</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>APP端组件</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/app/markerImgMobile/" class="sidebar-link">MarkerImgMobile 带标注的图片预览组件</a></li><li><a href="/vue_components/zh/app/mediasMobile/" class="sidebar-link">MediasMobile 媒体组件选择预览组件</a></li><li><a href="/vue_components/zh/app/switchBtn/" class="sidebar-link">SwitchBtn 按钮组</a></li><li><a href="/vue_components/zh/app/quickInput/" class="sidebar-link">QuickInput 快速输入框</a></li><li><a href="/vue_components/zh/app/iTouch/" class="sidebar-link">ITouch 触摸拖动库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>APP端mixin</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/appMixin/stRecovery/" class="sidebar-link">stRecovery 滚动位置恢复</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>库</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/library/observer/" class="sidebar-link">Observer 发布订阅库</a></li><li><a href="/vue_components/zh/library/measure/" class="sidebar-link">OpenLayers 测距离面积</a></li><li><a href="/vue_components/zh/library/markjs/" class="sidebar-link">markjs 标注库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>代码片段</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/fragment/openlayers/" class="sidebar-link">OpenLayers 相关</a></li><li><a href="/vue_components/zh/fragment/data/" class="sidebar-link">数据相关</a></li><li><a href="/vue_components/zh/fragment/date/" class="sidebar-link">时间日期相关</a></li><li><a href="/vue_components/zh/fragment/utils/" class="sidebar-link">工具函数</a></li><li><a href="/vue_components/zh/fragment/latLon/" class="sidebar-link">坐标系转换</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>具体业务组件</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/business/cm/multiStreet/" class="sidebar-link">【CM】MultiStreet 多街道</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/vue_components/zh/others/sites/" class="sidebar-link">网址导航</a></li></ul></section></li></ul></aside><main class="page"><div class="theme-default-content content__default"><h1 id="【汉诺塔】小游戏开发教程"><a href="#【汉诺塔】小游戏开发教程" class="header-anchor">#</a> 【汉诺塔】小游戏开发教程</h1><h2 id="游戏简介"><a href="#游戏简介" class="header-anchor">#</a> 游戏简介</h2><p>汉诺塔是源于印度一个古老传说的益智游戏，传说大梵天创造世界的时候顺便搞了三根柱子，一根柱子上摞着一堆从大到小的圆环，他命令婆罗门把圆环全部移动到另一个柱子上，依旧是从大到小，且移动规则如下：</p><div class="language- extra-class"><pre><code>1.一次只能把一个圆环从一根柱子移动到另一根柱子上

2.圆环的上面不能放比它大的圆环
</code></pre></div><p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c656522fd37445df909657eb16e48800~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><p>详细介绍及解法请参考文章：<a href="https://juejin.im/post/6875634825177333767" target="_blank" rel="noopener noreferrer">汉诺塔与递归<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><p>最终的成果示例请点击：<a href="http://lxqnsys.com/hnt/" target="_blank" rel="noopener noreferrer">汉诺塔小游戏<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><p>温馨提示：本篇教程属于从头到尾面面俱到型，虽然开发上本身是没什么难度的，但不妨碍把它做成一个很完善的游戏，所以它很长。</p><h2 id="布局"><a href="#布局" class="header-anchor">#</a> 布局</h2><p>本项目使用vue作为基础框架。</p><p>使用这些视图框架的主要思想就是操作数据，视图更新交给框架，只要做好数据和视图的映射即可，所以本游戏的核心也就是维护一些数据及操作数据。</p><p>首先要做的是布局，要模拟出上图中的三根柱子及圆环。本游戏全部使用DOM来布局，不使用canvas。</p><p>柱子的布局很简单，用div元素来作为线段，代码如下：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(column, cIndex)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item in columnList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>col<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>land<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Game'</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            columnList<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    name<span class="token operator">:</span> <span class="token string">'起始柱'</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    name<span class="token operator">:</span> <span class="token string">'中转柱'</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    name<span class="token operator">:</span> <span class="token string">'终点柱'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>样式部分很简单就不列出来了，效果如下：</p><p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2649d839c7b44d71bdc94cff73c1fecd~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><p>接下来是圆环，因为有三根柱子，所以使用三个数组来存放，每个圆环用一个对象来表示，每个圆环有颜色、代表大小的序号属性，序号从1开始，1代表最大，因为圆环数量可变，所以每个圆环的宽高、位置都需要动态进行计算，渲染同样是循环进行渲染，三个圆环的情况如下所示：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>column<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(item, cIndex) in columnList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--省略...--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ringsBox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> 
                <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ring<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(ringItem, index) in ringList[item.prop]<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ringItem.order<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">:</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token punctuation">{</span></span>
<span class="token attr-value">                    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>wsize - <span class="token punctuation">(</span>ringItem.order - 1<span class="token punctuation">)</span> * 10<span class="token punctuation">)</span> + <span class="token string">'%'</span><span class="token punctuation">,</span></span>
<span class="token attr-value">                    <span class="token property">height</span><span class="token punctuation">:</span> hsize / ringNum + <span class="token string">'%'</span><span class="token punctuation">,</span></span>
<span class="token attr-value">                    <span class="token property">backgroundColor</span><span class="token punctuation">:</span> ringItem.color<span class="token punctuation">,</span></span>
<span class="token attr-value">                    <span class="token property">left</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>100 - <span class="token punctuation">(</span>wsize - <span class="token punctuation">(</span>ringItem.order - 1<span class="token punctuation">)</span> * 10<span class="token punctuation">)</span><span class="token punctuation">)</span> / 2 + <span class="token string">'%'</span><span class="token punctuation">,</span></span>
<span class="token attr-value">                    <span class="token property">bottom</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>hsize / ringNum<span class="token punctuation">)</span> * index + <span class="token string">'%'</span></span>
<span class="token attr-value">                <span class="token punctuation">}</span></span><span class="token punctuation">&quot;</span></span>
            <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;Game&quot;</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token comment">// 柱子</span>
            <span class="token comment">// 增加了一个prop属性，代表该柱子对应的圆环数组</span>
            columnList<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    name<span class="token operator">:</span> <span class="token string">&quot;起始柱&quot;</span><span class="token punctuation">,</span>
                    prop<span class="token operator">:</span> <span class="token string">&quot;startColRingList&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    name<span class="token operator">:</span> <span class="token string">&quot;中转柱&quot;</span><span class="token punctuation">,</span>
                    prop<span class="token operator">:</span> <span class="token string">&quot;transferColRingList&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    name<span class="token operator">:</span> <span class="token string">&quot;终点柱&quot;</span><span class="token punctuation">,</span>
                    prop<span class="token operator">:</span> <span class="token string">&quot;endColRingList&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token comment">// 圆环</span>
            <span class="token comment">// 圆环数量</span>
            ringNum<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token comment">// 圆环数据</span>
            ringList<span class="token operator">:</span> <span class="token punctuation">{</span>
                startColRingList<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        color<span class="token operator">:</span> <span class="token string">&quot;#ffa36c&quot;</span><span class="token punctuation">,</span>
                        order<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        color<span class="token operator">:</span> <span class="token string">&quot;#00bcd4&quot;</span><span class="token punctuation">,</span>
                        order<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        color<span class="token operator">:</span> <span class="token string">&quot;#848ccf&quot;</span><span class="token punctuation">,</span>
                        order<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                transferColRingList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                endColRingList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    computed<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 最大宽度值</span>
        <span class="token function">wsize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringNum <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token operator">?</span> <span class="token number">50</span> <span class="token operator">:</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ringNum <span class="token operator">*</span> <span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 最大高度值</span>
        <span class="token function">hsize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringNum <span class="token operator">&lt;=</span> <span class="token number">3</span> <span class="token operator">?</span> <span class="token number">30</span> <span class="token operator">:</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ringNum <span class="token operator">*</span> <span class="token number">10</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>效果如下所示：</p><p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f73129d56f842faad5f5dee5f004a34~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><h2 id="拖动"><a href="#拖动" class="header-anchor">#</a> 拖动</h2><p>这个游戏主要的交互就是拖动圆环到另一根柱子上，所以圆环需要支持拖动，需要注意的是每根柱子上都只有最上面的一个圆环能被拖动，且拖动到的柱子上存在的最上面的圆环还要比它大，否则不允许落下。</p><p>具体的实现就是监听鼠标按下事件、鼠标移动事件、鼠标松开事件，鼠标按下移动时改变该圆环的<code>transform: translate(x,y)</code>属性来进行移动，鼠标松开时判断当前圆环被拖动到的位置是否在三个圆环的某一个区域内，是的话再判断圆环能否落到该柱子上，符合条件就把该圆环的数据从之前柱子的数组移到落下柱子的数组内，否则就复位<code>transform</code>属性让圆环回去。</p><p>绑定事件需要注意的是按下事件绑定到圆环上，而移动和松开事件要绑定到body上，否则当你移动过快时鼠标指针可能会和圆环不同步而超出圆环，进而当你松开后就监听不到松开事件了。</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>column<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(column, cIndex) in columnList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--省略...--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ringsBox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> 
                <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ring<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(ringItem, index) in ringList[item.prop]<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">&lt;!--省略...--</span><span class="token punctuation">&gt;</span></span>
                @mousedown=&quot;mousedown($event, ringItem, index, item.prop, cIndex)&quot;
            &gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;Game&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bindEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unbindEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 鼠标移动事件和松开事件绑定到body上</span>
        <span class="token function">bindEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mousemove<span class="token punctuation">)</span>
            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseup'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mouseup<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">// 解绑事件</span>
        <span class="token function">unbindEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mousemove<span class="token punctuation">)</span>
            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseup'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mouseup<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>接下来重点实现这三个事件处理函数。</p><p>先定义一些必要的变量：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 拖动变量</span>
    dragProp<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">// 当前拖动圆环所属的柱子</span>
    dragOrder<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">// 当前拖动圆环的大小序号</span>
    dragIndex<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">// 当前拖动圆环在原柱子上的索引</span>
    dragColumnIndex<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">// 当前拖动圆环所在柱子的索引</span>
    draging<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">// 当前是否是拖动中</span>
    startPos<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">// 鼠标按下时的坐标</span>
        x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        y<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    dragPos<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">// 鼠标移动的偏移量</span>
        x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        y<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>拖动是拖动当前鼠标按下的圆环，因为是在循环体里添加的css属性，所以对所有圆环都是有效的，那么怎么判断目标圆环是哪个圆环，对于圆环来说，它的<code>order</code>属性是唯一的，所以根据<code>dragOrder</code>变量就可以定位到了，是的话就让它的<code>translate</code>的值随着<code>dragPos</code>的值进行变化：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>column<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(column, cIndex) in columnList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--省略...--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ringsBox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> 
                <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ring<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(ringItem, index) in ringList[item.prop]<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ringItem.order<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">:</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token punctuation">{</span></span>
<span class="token attr-value">                    &lt;!--省略...--&gt;</span>
<span class="token attr-value">                    <span class="token selector">transform: dragOrder === ringItem.order ? `translate($</span><span class="token punctuation">{</span>dragPos.x<span class="token punctuation">}</span><span class="token selector">px, $</span><span class="token punctuation">{</span>dragPos.y<span class="token punctuation">}</span>px<span class="token punctuation">)</span>` <span class="token punctuation">:</span> <span class="token string">'translate(0px, 0px)'</span></span>
<span class="token attr-value">                <span class="token punctuation">}</span></span><span class="token punctuation">&quot;</span></span>
            <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>鼠标按下事件处理函数的主要逻辑是设置拖动标志位、缓存当前拖动的一些数据，比如当前拖动圆环的相关信息及鼠标按下的位置信息：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 鼠标按下事件</span>
    <span class="token function">mousedown</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> ringItem<span class="token punctuation">,</span> index<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> columnIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 当按下的不是该柱子最上面的圆环时不做任何处理</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringList<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragProp <span class="token operator">=</span> prop
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragOrder <span class="token operator">=</span> ringItem<span class="token punctuation">.</span>order
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragIndex <span class="token operator">=</span> index
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragColumnIndex <span class="token operator">=</span> columnIndex
        <span class="token keyword">this</span><span class="token punctuation">.</span>startPos<span class="token punctuation">.</span>x <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX
        <span class="token keyword">this</span><span class="token punctuation">.</span>startPos<span class="token punctuation">.</span>y <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY
        <span class="token keyword">this</span><span class="token punctuation">.</span>draging <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>鼠标移动事件处理函数的功能是实时更新拖动的偏移量，圆环就会跟着动了：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 鼠标移动事件</span>
    <span class="token function">mousemove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不是拖动的情况直接返回</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>draging<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragPos<span class="token punctuation">.</span>x <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startPos<span class="token punctuation">.</span>x
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragPos<span class="token punctuation">.</span>y <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startPos<span class="token punctuation">.</span>y
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>鼠标松开事件是最重要的，在该函数里需要判断圆环是否拖动到某个柱子区域内及能否落下及具体的落下操作：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 鼠标松开事件</span>
    <span class="token function">mouseup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不是拖动的情况直接返回</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>draging<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 复位拖动标志位</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>draging <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token comment">// 计算圆环拖动到哪个柱子上</span>
        <span class="token keyword">let</span> columnIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkInColumnIndex</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dragOrder<span class="token punctuation">)</span>
        <span class="token comment">// 判断圆环是否可以落到该柱子上</span>
        <span class="token keyword">let</span> canDraged <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">canDraged</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dragOrder<span class="token punctuation">)</span>
        <span class="token comment">// 能落下的话就移动该圆环的数据</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>canDraged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dragToColumn</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dragProp<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dragIndex<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 复位</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来一步步来实现该函数里的几个方法。</p><p>因为涉及到位置计算，所以需要获取实际的DOM元素，先在模板里加上ref用于引用DOM:</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>column<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(item, cIndex) in columnList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item.name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>column' + cIndex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ringsBox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> 
                <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ring<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(ringItem, index) in ringList[item.prop]<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">:ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>ring' + ringItem.order<span class="token punctuation">&quot;</span></span>
            <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>首先柱子区域是一个矩形，如下所示：</p><p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/508b96780ba84f1b9ad353df8c518e88~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>然后圆环其实也是一个矩形，那么问题实际上就转换为求两个矩形是否相交，这个是很简单的，方便起见，把它们的位置都相对于浏览器窗口左上角来计算，那么满足下面的条件圆环和柱子区域即相交：</p><div class="language- extra-class"><pre><code>1.圆环的右侧距窗口左侧的距离大于柱子区域左侧距窗口左侧的距离、同时圆环左侧距窗口的距离小于柱子区域右侧距窗口左侧的距离
2.圆环的顶部距窗口顶部的距离小于柱子区域的底部距窗口顶部的距离、同时圆环的底部距窗口顶部的距离大于柱子区域顶部距窗口顶部的距离
</code></pre></div><p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a01d15f85bbe48ce9aa7bb367c8c33a8~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>翻译成代码如下：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 检查某个圆环的位置是否在某个柱子区域内</span>
    <span class="token function">checkInColumnIndex</span><span class="token punctuation">(</span><span class="token parameter">order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token comment">// 获取圆环相当于浏览器窗口的位置信息</span>
        <span class="token keyword">let</span> ringRect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span><span class="token string">'ring'</span> <span class="token operator">+</span> order<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 遍历获取柱子区域相当于浏览器窗口的位置信息</span>
        <span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取区域位置信息</span>
            <span class="token keyword">let</span> <span class="token punctuation">{</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span><span class="token string">'column'</span> <span class="token operator">+</span> index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// 重合检查</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>
                <span class="token punctuation">(</span>ringRect<span class="token punctuation">.</span>right <span class="token operator">&gt;=</span> left <span class="token operator">&amp;&amp;</span> ringRect<span class="token punctuation">.</span>left <span class="token operator">&lt;=</span> right<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ringRect<span class="token punctuation">.</span>top <span class="token operator">&lt;=</span> bottom <span class="token operator">&amp;&amp;</span> ringRect<span class="token punctuation">.</span>bottom <span class="token operator">&gt;=</span> top<span class="token punctuation">)</span><span class="token punctuation">)</span> 
            <span class="token punctuation">{</span>
                result <span class="token operator">=</span> index
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> result
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>知道了在哪个圆环后接下来要判断是否可以落下，根据游戏规则，小的圆环上不能放大的，所以判断当前柱子上最小的圆环是否比当前圆环大即可：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 判断某个圆环是否可以落到指定索引的柱子上</span>
    <span class="token function">canDraged</span><span class="token punctuation">(</span><span class="token parameter">columnIndex<span class="token punctuation">,</span> order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不在圆环区域内直接返回</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>columnIndex <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> 
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> prop <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>columnList<span class="token punctuation">[</span>columnIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>prop
        <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringList<span class="token punctuation">[</span>prop<span class="token punctuation">]</span>
        <span class="token comment">// 柱子为空则可以落下</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 数组里最后一项即是当前柱子最小的圆环</span>
        <span class="token keyword">let</span> minOrder <span class="token operator">=</span> list<span class="token punctuation">[</span>list<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>order
        <span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">&gt;</span> minOrder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>判断如果是可以落下的那么直接将该圆环的数组从原柱子数组移到目标数组即可：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 某个圆环落到指定索引的柱子上</span>
    <span class="token function">dragToColumn</span><span class="token punctuation">(</span><span class="token parameter">columnIndex<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 从原数组取出</span>
        <span class="token keyword">let</span> ring <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringList<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment">// 追加到目标数组</span>
        <span class="token keyword">let</span> toProp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>columnList<span class="token punctuation">[</span>columnIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>prop
        <span class="token keyword">this</span><span class="token punctuation">.</span>ringList<span class="token punctuation">[</span>toProp<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ring<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果不能落下的话那么就让圆环回去，圆环的位置要回去的话直接把<code>dragPos</code>的值恢复要0即可，其他的相关变量也需要复位：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 拖动完成后复位</span>
    <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragProp <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragOrder <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragIndex <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>draging <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragColumnIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>startPos<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>startPos<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragPos<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragPos<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>到这里游戏的核心功能就完成了，已经可以玩了：</p><p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ee8942cdcff457cb0c5cb3868d0dc53~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>图上的圆环移到某个区域内显示的背景突出效果实现也很简单，在移动过程中不断检测是否相交，是的话就给对应的区域加上背景的类名：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>column<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(item, cIndex) in columnList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item.name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>column' + cIndex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{dragIn: dragingColumnIndex === cIndex}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

{
    data() {
        return {
            dragingColumnIndex: -1//拖动过程中实时相交的区域索引
        }
    },
    methods: {
        mousemove(e) {
            //...
            this.dragingColumnIndex = this.checkInColumnIndex(this.dragOrder)
        }
    }
}
</code></pre></div><h2 id="完成检测"><a href="#完成检测" class="header-anchor">#</a> 完成检测</h2><p>每一次拖动后都要判断游戏是否完成，判断方式很简单，检测目标数组不为空，而其他两根柱子的数组为空就可以了，或者直接检测目标数组里的圆环数量是否和当前层数对应，反正方式有很多。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 检测游戏是否完成</span>
    <span class="token function">checkPass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ringList<span class="token punctuation">.</span>endColRingList<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'恭喜你，完成啦'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>就是这么简单。</p><p>游戏基本功能到这里就结束了，但是作为一个有梦想有追求的人，完成基本功能只意味着开始，随便想想，就能想到还有很多能做的：游戏层数选择、操作按钮、信息显示，还有一些高级功能：回退操作、自动操作、步骤回放等等，因为篇幅原因，本篇不会全部展开讲解，只挑一两个来浅析一下，不要走开，精彩继续。</p><h2 id="动画过度"><a href="#动画过度" class="header-anchor">#</a> 动画过度</h2><p>首先先做个优化，目前来说，当你拖动圆环到某个柱子上松开时圆环是瞬间显示到柱子上的，而不是过渡过去的，包括当松开鼠标不符合落下条件圆环回去也是一样，突变总是不优雅的，我们让它平滑的滑动起来。</p><p>因为圆环是使用css的<code>translate</code>属性来跟随鼠标动的，所以只要给它加上<code>transition</code>属性即可平滑过渡，要注意的是拖动过程中该属性的值必须为<code>none</code>，否则你每拖动一下，它都要缓一下过渡过去，所以该属性的值要动态进行设置。</p><p>圆环不符合落下条件时复位的过渡不需要修改，加上<code>transition</code>就有过渡能力了，主要是符合落下条件时从鼠标松开的位置过渡到目标位置需要计算一下，看图：</p><p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a89e576506f0432094fd386f79d0d096~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>因为拖动中的圆环的<code>transition</code>的坐标也就是<code>dragPos</code>属性的值是相当于鼠标按下的位置来说的，其实也就是圆环开始的位置，所以只要知道圆环即将落到的目标位置相对于圆环开始的位置，把该坐标设置给<code>dragPos</code>就可以了，css动画方式就是如此的简单明了：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>column<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(item, cIndex) in columnList<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ringsBox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> 
                <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ring<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(ringItem, index) in ringList[item.prop]<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">:</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token punctuation">{</span></span>
<span class="token attr-value">                    &lt;!--省略...--&gt;</span>
<span class="token attr-value">                    <span class="token property">transition</span><span class="token punctuation">:</span> transition</span>
<span class="token attr-value">                <span class="token punctuation">}</span></span><span class="token punctuation">&quot;</span></span>
            <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

{
    data() {
        return {
            transition: 'none'
        }
    },
    methods: {
        mousedown(e, ringItem, index, prop, columnIndex) {
            // ...
            // 鼠标按下时说明可能要进行拖动，那么该属性要设为null
            this.transition = 'none'
            // ...
        },
        // 重点改造鼠标松开事件函数
        async mouseup() {
            if (!this.draging) {
                return
            }
            this.draging = false
            let columnIndex = this.checkInColumnIndex(this.dragOrder)
            let canDraged = this.canDraged(columnIndex, this.dragOrder)
            // 设置过渡效果
            this.transition = 'all 0.5s'
            if (canDraged) {
                // 核心函数，让圆环从松开的位置移动到目标位置，因为过渡需要时间，所以使用await进行等待
                await this.moveToNewPos(columnIndex, this.dragProp, this.dragIndex)
                // 圆环物理位置过去以后，实际该圆环的数据还是在原来的柱子数组里的，所以还是需要把它移到目标数组
                this.dragToColumn(columnIndex, this.dragProp, this.dragIndex)
                // 过渡完以后删掉过渡效果
                this.transition = 'none'
                // 复位数据
                this.reset()
                this.checkPass()
            } else {
                this.reset()
            }
        }
    }
}
</code></pre></div><p>接下来就是要实现上面的移动函数<code>moveToNewPos</code>，其实就是计算目标位置的坐标，该坐标是相当于圆环起始坐标来说的，方便计算也先它们都转化为相当于浏览器窗口，然后相减就得到了最终结果：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
   <span class="token function">moveToNewPos</span><span class="token punctuation">(</span><span class="token parameter">columnIndex<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 因为过渡需要500毫秒，所以使用promise</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> rejct</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> ring <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringList<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span>
            <span class="token comment">// 将圆环起始坐标转化为距浏览器窗口坐标</span>
            <span class="token keyword">let</span> startPos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRingPosOffsetWindow</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dragColumnIndex<span class="token punctuation">,</span> ring<span class="token punctuation">.</span>order<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token comment">// 将圆环目标坐标转化为距浏览器窗口坐标</span>
            <span class="token keyword">let</span> endPos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRingPosOffsetWindow</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">,</span> ring<span class="token punctuation">.</span>order<span class="token punctuation">)</span>
            <span class="token comment">// 相减得到目标坐标相当于起始坐标的值</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>dragPos<span class="token punctuation">.</span>x <span class="token operator">=</span> endPos<span class="token punctuation">.</span>left <span class="token operator">-</span> startPos<span class="token punctuation">.</span>left
            <span class="token keyword">this</span><span class="token punctuation">.</span>dragPos<span class="token punctuation">.</span>y <span class="token operator">=</span> endPos<span class="token punctuation">.</span>top <span class="token operator">-</span> startPos<span class="token punctuation">.</span>top
            <span class="token comment">// 让圆环过渡完</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><p><code>getRingPosOffsetWindow</code>方法是计算某个柱子上指定索引的圆环的位置相当于浏览器窗口的距离，第三个参数为<code>true</code>代表该圆环是否已经存在于该柱子，为<code>false</code>代表是即将落下的目标位置：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token function">getRingPosOffsetWindow</span><span class="token punctuation">(</span><span class="token parameter">columnIndex<span class="token punctuation">,</span> order<span class="token punctuation">,</span> exist</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 该柱子的圆环数组</span>
        <span class="token keyword">let</span> prop <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>columnList<span class="token punctuation">[</span>columnIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>prop
        <span class="token comment">// 该柱子区域的尺寸位置信息</span>
        <span class="token keyword">let</span> rect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span><span class="token string">'column'</span> <span class="token operator">+</span> columnIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 圆环在该柱子上的索引</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringList<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token punctuation">(</span>exist <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment">// 圆环相当于柱子区域的位置信息</span>
        <span class="token keyword">let</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>wsize <span class="token operator">-</span> <span class="token punctuation">(</span>order <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token string">'%'</span>
        <span class="token keyword">let</span> bottom <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>hsize <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringNum<span class="token punctuation">)</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token string">'%'</span>
        <span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hsize <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringNum <span class="token operator">+</span> <span class="token string">'%'</span>
        <span class="token comment">// 转换为像素</span>
        <span class="token keyword">let</span> leftPx <span class="token operator">=</span> rect<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span>
        <span class="token comment">// 底部线段占了5像素</span>
        <span class="token keyword">let</span> _height <span class="token operator">=</span> rect<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">5</span>
        <span class="token keyword">let</span> topPx <span class="token operator">=</span> _height <span class="token operator">-</span> <span class="token punctuation">(</span>_height <span class="token operator">*</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>bottom<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span> <span class="token operator">*</span> _height <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token comment">// 转换为屏幕上的坐标</span>
        <span class="token keyword">let</span> windowLeftPx <span class="token operator">=</span> rect<span class="token punctuation">.</span>left <span class="token operator">+</span> leftPx
        <span class="token keyword">let</span> windowTopPx <span class="token operator">=</span> rect<span class="token punctuation">.</span>top <span class="token operator">+</span> topPx
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            left<span class="token operator">:</span> windowLeftPx<span class="token punctuation">,</span> 
            top<span class="token operator">:</span> windowTopPx
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>到这里松开圆环圆环就会过渡到目标位置，</p><h2 id="最少步数与自动操作"><a href="#最少步数与自动操作" class="header-anchor">#</a> 最少步数与自动操作</h2><p>汉诺塔游戏可以用递归来求解，详细了解可参考文章开头提到的文章，此处不再赘述，直接贴出递归函数：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            minStepNum<span class="token operator">:</span> <span class="token number">0</span><span class="token comment">//当前层数最少步数</span>
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 计算指定层数的解法吉最少步数</span>
        <span class="token function">resolveHannuota</span><span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span> start<span class="token punctuation">,</span> transfer<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveHannuota</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> transfer<span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>start <span class="token operator">+</span> <span class="token string">'-&gt;'</span> <span class="token operator">+</span> end<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>minStepNum<span class="token operator">++</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveHannuota</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> transfer<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>层数改变很简单，把之前写死的<code>startColRingList</code>数组改成遍历生成就可以了，每次层数改变后都调一下上面的<code>resolveHannuota</code>方法，<code>minStepNum</code>累加的结果就是最少次数，<code>console.log</code>打印的就是步骤，三层打印的结果如下所示：</p><div class="language- extra-class"><pre class="language-text"><code>startColRingList-&gt;endColRingList
startColRingList-&gt;transferColRingList
endColRingList-&gt;transferColRingList
startColRingList-&gt;endColRingList
transferColRingList-&gt;startColRingList
transferColRingList-&gt;endColRingList
startColRingList-&gt;endColRingList
</code></pre></div><p>可以通过解析该数据来实现自动操作。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 柱子索引</span>
<span class="token keyword">const</span> propIndex <span class="token operator">=</span> <span class="token punctuation">{</span>
    startColRingList<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    transferColRingList<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    endColRingList<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// 自动操作</span>
<span class="token keyword">function</span> <span class="token function">auto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> <span class="token function-variable function">loop</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// autoStepList数组就是上面console打印的内容</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>autoStepList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> cur <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>autoStepList<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        <span class="token keyword">let</span> columnIndex <span class="token operator">=</span> propIndex<span class="token punctuation">[</span>cur<span class="token punctuation">.</span>to<span class="token punctuation">]</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragColumnIndex <span class="token operator">=</span> propIndex<span class="token punctuation">[</span>cur<span class="token punctuation">.</span>from<span class="token punctuation">]</span>
        <span class="token keyword">let</span> dragIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringList<span class="token punctuation">[</span>cur<span class="token punctuation">.</span>from<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">&quot;all 0.5s&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragOrder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringList<span class="token punctuation">[</span>cur<span class="token punctuation">.</span>from<span class="token punctuation">]</span><span class="token punctuation">[</span>dragIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>order
        <span class="token comment">// 调用之前过渡的方法</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">moveToNewPos</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">,</span> cur<span class="token punctuation">.</span>from<span class="token punctuation">,</span> dragIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 移动数组元素</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dragToColumn</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">,</span> cur<span class="token punctuation">.</span>from<span class="token punctuation">,</span> dragIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragPos<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragPos<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span>
        index<span class="token operator">++</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e2f6a687e1924178bcaae6687f40eda9~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h2 id="返回上一步"><a href="#返回上一步" class="header-anchor">#</a> 返回上一步</h2><p>返回上一步也很简单，通过数组记录下每一步，然后每点一次就把数组最后一项弹出来，通过上述动画方式移动对应的圆环即可。</p><p>首先在之前的<code>mouseup</code>函数里保存每一步的操作：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 鼠标松开事件函数</span>
    <span class="token keyword">async</span> <span class="token function">mouseup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">'all 0.5s'</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>canDraged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">moveToNewPos</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dragProp<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dragIndex<span class="token punctuation">)</span>
            
            <span class="token comment">// 在这里把这一步的操作添加到数组里，注意回退操作是把这一步的目标位置回到开始位置</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>historyList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                to<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dragProp<span class="token punctuation">,</span>
                <span class="token keyword">from</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>columnList<span class="token punctuation">[</span>columnIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>prop
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后点点击回退按钮时弹出最后一步进行回退：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// 返回上一步</span>
    <span class="token keyword">async</span> <span class="token function">goback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>historyList<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> cur <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>historyList<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> columnIndex <span class="token operator">=</span> propIndex<span class="token punctuation">[</span>cur<span class="token punctuation">.</span>to<span class="token punctuation">]</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragColumnIndex <span class="token operator">=</span> propIndex<span class="token punctuation">[</span>cur<span class="token punctuation">.</span>from<span class="token punctuation">]</span>
        <span class="token keyword">let</span> dragIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringList<span class="token punctuation">[</span>cur<span class="token punctuation">.</span>from<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">&quot;all 0.5s&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragOrder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ringList<span class="token punctuation">[</span>cur<span class="token punctuation">.</span>from<span class="token punctuation">]</span><span class="token punctuation">[</span>dragIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>order
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">moveToNewPos</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">,</span> cur<span class="token punctuation">.</span>from<span class="token punctuation">,</span> dragIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dragToColumn</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">,</span> cur<span class="token punctuation">.</span>from<span class="token punctuation">,</span> dragIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragPos<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dragPos<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>至此，游戏的全部功能都已完成，源代码已经上传到github：<a href="https://github.com/wanglin2/hannuota" target="_blank" rel="noopener noreferrer">https://github.com/wanglin2/hannuota<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div><footer class="page-edit"><!----><!----></footer><div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue_components/zh/about/" class="prev">
        关于
      </a></span><span class="next"><a href="/vue_components/zh/share/11.html">
        OpenLayers入门（二）
      </a>
      →
    </span></p></div></main></div><div class="global-ui"><!----></div></div>
    <script src="/vue_components/assets/js/app.2a8a8f25.js" defer></script><script src="/vue_components/assets/js/3.2c2d63e0.js" defer></script><script src="/vue_components/assets/js/52.40ef81eb.js" defer></script>
  </body>
</html>
